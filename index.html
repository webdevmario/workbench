<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Workbench</title>
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect fill='%230a0a0b' width='100' height='100' rx='20'/><circle cx='50' cy='50' r='12' fill='%2300d4aa'/></svg>">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600&family=Outfit:wght@300;400;500;600&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg: #0a0a0b;
      --surface: #131316;
      --surface-hover: #1a1a1f;
      --border: #2a2a30;
      --text: #e8e8ed;
      --text-muted: #8888a0;
      --accent: #00d4aa;
      --accent-dim: rgba(0, 212, 170, 0.15);
      --danger: #ff5c5c;
      --danger-dim: rgba(255, 92, 92, 0.15);
    }

    * { margin: 0; padding: 0; box-sizing: border-box; }

    html {
      overflow-y: scroll; /* Always show scrollbar to prevent layout shift */
    }

    body {
      font-family: 'Outfit', sans-serif;
      background: var(--bg);
      color: var(--text);
      min-height: 100vh;
      padding: 40px;
    }

    /* Custom scrollbar styling */
    ::-webkit-scrollbar {
      width: 8px;
    }

    ::-webkit-scrollbar-track {
      background: transparent;
    }

    ::-webkit-scrollbar-thumb {
      background: var(--border);
      border-radius: 4px;
    }

    ::-webkit-scrollbar-thumb:hover {
      background: var(--text-muted);
    }

    .container { max-width: 900px; margin: 0 auto; }

    /* ‚îÄ‚îÄ Header ‚îÄ‚îÄ */
    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 24px;
      padding-bottom: 16px;
      border-bottom: 1px solid var(--border);
    }

    .brand {
      font-weight: 600;
      font-size: 1.25rem;
      letter-spacing: -0.02em;
      display: flex;
      align-items: center;
      gap: 10px;
      color: var(--text-muted);
    }

    .brand-dot {
      width: 8px;
      height: 8px;
      background: var(--accent);
      border-radius: 50%;
    }

    .header-actions {
      display: flex;
      gap: 10px;
    }

    /* ‚îÄ‚îÄ App Switcher ‚îÄ‚îÄ */
    .app-nav-container {
      display: flex;
      justify-content: center;
      margin-bottom: 28px;
    }

    .app-nav {
      display: flex;
      gap: 4px;
      background: var(--surface);
      border-radius: 10px;
      padding: 4px;
      border: 1px solid var(--border);
    }

    .app-tab {
      font-family: inherit;
      font-size: 0.875rem;
      font-weight: 500;
      padding: 10px 24px;
      border-radius: 7px;
      border: none;
      cursor: pointer;
      background: transparent;
      color: var(--text-muted);
      transition: all 0.2s ease;
      width: 140px;
      text-align: center;
      position: relative;
    }

    /* Divider between tabs */
    .app-tab:not(:last-child)::after {
      content: '';
      position: absolute;
      right: -2px;
      top: 50%;
      transform: translateY(-50%);
      height: 20px;
      width: 1px;
      background: var(--border);
      transition: opacity 0.2s ease;
    }

    /* Hide divider next to active tab */
    .app-tab.active::after,
    .app-tab:has(+ .app-tab.active)::after {
      opacity: 0;
    }

    .app-tab:hover { color: var(--text); }

    .app-tab.active {
      background: var(--accent);
      color: var(--bg);
    }

    .app-view { display: none; }
    .app-view.active { display: block; }

    /* ‚îÄ‚îÄ Shared Components ‚îÄ‚îÄ */
    .btn {
      font-family: inherit;
      font-size: 0.875rem;
      font-weight: 500;
      padding: 10px 20px;
      border-radius: 8px;
      border: none;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .btn-ghost {
      background: transparent;
      color: var(--text-muted);
      border: 1px solid var(--border);
    }

    .btn-ghost:hover {
      background: var(--surface);
      color: var(--text);
    }

    .btn-accent {
      background: var(--accent);
      color: var(--bg);
    }

    .btn-accent:hover { filter: brightness(1.1); }

    .btn-sm {
      padding: 7px 14px;
      font-size: 0.8rem;
    }

    .input-group {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .input-group label {
      font-size: 0.75rem;
      text-transform: uppercase;
      letter-spacing: 0.1em;
      color: var(--text-muted);
    }

    .input-group input,
    .input-group select,
    .input-group textarea {
      font-family: inherit;
      font-size: 1rem;
      padding: 14px 16px;
      background: var(--bg);
      border: 1px solid var(--border);
      border-radius: 8px;
      color: var(--text);
      outline: none;
      transition: border-color 0.2s ease;
      resize: vertical;
    }

    .input-group input:focus,
    .input-group select:focus,
    .input-group textarea:focus {
      border-color: var(--accent);
    }

    .input-group input::placeholder,
    .input-group textarea::placeholder {
      color: var(--text-muted);
    }

    .input-group select { 
      cursor: pointer;
      -webkit-appearance: none;
      -moz-appearance: none;
      appearance: none;
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 24 24' fill='none' stroke='%237a7a85' stroke-width='2'%3E%3Cpolyline points='6 9 12 15 18 9'/%3E%3C/svg%3E");
      background-repeat: no-repeat;
      background-position: right 14px center;
      padding-right: 40px;
    }

    .modal-close {
      position: absolute;
      top: 16px;
      right: 16px;
      width: 32px;
      height: 32px;
      border-radius: 8px;
      background: var(--bg);
      border: 1px solid var(--border);
      color: var(--text-muted);
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.15s ease;
    }

    .modal-close:hover {
      border-color: var(--text-muted);
      color: var(--text);
    }

    .modal {
      position: relative;
    }

    .btn-icon {
      width: 36px;
      height: 36px;
      border-radius: 8px;
      background: var(--bg);
      border: 1px solid var(--border);
      color: var(--text-muted);
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s ease;
    }

    .btn-icon:hover {
      border-color: var(--accent);
      color: var(--accent);
    }

    .btn-icon.danger:hover {
      border-color: var(--danger);
      color: var(--danger);
    }

    .btn-icon.resume:hover {
      border-color: var(--accent);
      color: var(--accent);
      background: var(--accent-dim);
    }

    .empty-state {
      text-align: center;
      padding: 60px 20px;
      color: var(--text-muted);
    }

    .empty-state svg {
      width: 48px;
      height: 48px;
      margin-bottom: 16px;
      opacity: 0.3;
    }

    /* ‚îÄ‚îÄ Date Navigation ‚îÄ‚îÄ */
    .daily-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 24px;
    }

    .date-nav {
      display: flex;
      align-items: center;
      gap: 16px;
    }

    .date-nav button {
      background: var(--surface);
      border: 1px solid var(--border);
      color: var(--text-muted);
      width: 36px;
      height: 36px;
      border-radius: 8px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.15s ease;
    }

    .date-nav button:hover {
      border-color: var(--accent);
      color: var(--accent);
    }

    .date-nav span {
      font-weight: 500;
      min-width: 180px;
      text-align: center;
    }

    .daily-header-right {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    /* ‚îÄ‚îÄ Modal ‚îÄ‚îÄ */
    .modal-overlay {
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0, 0, 0, 0.8);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 100;
    }

    .modal-overlay.active { display: flex; }

    .modal {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 16px;
      padding: 32px;
      width: 100%;
      max-width: 480px;
    }

    .modal h3 {
      font-weight: 500;
      margin-bottom: 24px;
    }

    .modal .input-group { margin-bottom: 16px; }

    .modal-actions {
      display: flex;
      justify-content: flex-end;
      gap: 12px;
      margin-top: 24px;
    }

    /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
       TIME TRACKER
       ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
    .timer-section {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 16px;
      padding: 32px;
      margin-bottom: 48px;
    }

    .timer-display {
      font-family: 'JetBrains Mono', monospace;
      font-size: 4rem;
      font-weight: 500;
      text-align: center;
      margin-bottom: 32px;
      letter-spacing: -0.02em;
      color: var(--accent);
      opacity: 0.3;
      transition: opacity 0.3s ease;
    }

    .timer-display.active {
      opacity: 1;
      animation: pulse 2s ease-in-out infinite;
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.7; }
    }

    .input-row {
      display: grid;
      grid-template-columns: 1fr 200px;
      gap: 16px;
      margin-bottom: 24px;
    }

    .timer-controls {
      display: flex;
      justify-content: center;
      gap: 16px;
    }

    .btn-start {
      background: var(--accent);
      color: var(--bg);
      font-size: 1rem;
      padding: 16px 48px;
      border-radius: 12px;
      font-weight: 600;
      letter-spacing: 0.02em;
    }

    .btn-start:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 24px rgba(0, 212, 170, 0.3);
    }

    .btn-stop {
      background: var(--danger);
      color: white;
      font-size: 1rem;
      padding: 16px 48px;
      border-radius: 12px;
      font-weight: 600;
    }

    .btn-stop:hover { filter: brightness(1.1); }

    .total-time {
      font-family: 'JetBrains Mono', monospace;
      font-size: 0.875rem;
      color: var(--accent);
      background: var(--accent-dim);
      padding: 8px 16px;
      border-radius: 20px;
    }

    .entries-list {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .entry {
      display: grid;
      grid-template-columns: 165px 1fr 80px auto;
      gap: 20px;
      align-items: center;
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 20px 24px;
      transition: all 0.2s ease;
    }

    .entry:hover {
      border-color: var(--accent);
      background: var(--surface-hover);
    }

    .entry-time {
      font-family: 'JetBrains Mono', monospace;
      font-size: 0.8rem;
      color: var(--text-muted);
      white-space: nowrap;
    }

    .entry-details { display: flex; flex-direction: column; gap: 4px; }
    .entry-description { font-weight: 500; font-size: 1rem; }

    .entry-category {
      font-size: 0.75rem;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: var(--accent);
    }

    .entry-duration {
      font-family: 'JetBrains Mono', monospace;
      font-size: 0.875rem;
      text-align: right;
    }

    .entry-actions {
      display: flex;
      gap: 8px;
      opacity: 0;
      transition: opacity 0.2s ease;
    }

    .entry:hover .entry-actions { opacity: 1; }

    .category-summary {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
      gap: 12px;
      margin-bottom: 24px;
    }

    .category-summary:empty { display: none; }

    .summary-card {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 10px;
      padding: 16px 20px;
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .summary-card-label {
      font-size: 0.75rem;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: var(--text-muted);
    }

    .summary-card-time {
      font-family: 'JetBrains Mono', monospace;
      font-size: 1.25rem;
      font-weight: 500;
      color: var(--accent);
    }

    .summary-card-bar {
      height: 4px;
      background: var(--border);
      border-radius: 2px;
      margin-top: 8px;
      overflow: hidden;
    }

    .summary-card-bar-fill {
      height: 100%;
      background: var(--accent);
      border-radius: 2px;
      transition: width 0.3s ease;
    }

    .time-inputs {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 16px;
    }

    .category-list {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 12px;
    }

    .category-tag {
      display: flex;
      align-items: center;
      gap: 8px;
      background: var(--bg);
      border: 1px solid var(--border);
      border-radius: 6px;
      padding: 6px 12px;
      font-size: 0.875rem;
    }

    .category-tag button {
      background: none;
      border: none;
      color: var(--text-muted);
      cursor: pointer;
      padding: 0;
      line-height: 1;
    }

    .category-tag button:hover { color: var(--danger); }

    .add-category {
      display: flex;
      gap: 8px;
      margin-top: 12px;
    }

    .add-category input {
      flex: 1;
      font-family: inherit;
      font-size: 0.875rem;
      padding: 8px 12px;
      background: var(--bg);
      border: 1px solid var(--border);
      border-radius: 6px;
      color: var(--text);
      outline: none;
    }

    .add-category input:focus { border-color: var(--accent); }

    /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
       TASKS
       ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
    .task-input-section {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 16px;
      padding: 28px;
      margin-bottom: 48px;
    }

    .task-input-row {
      display: flex;
      gap: 12px;
      align-items: flex-end;
    }

    .task-input-row .input-group { flex: 1; }

    .task-list {
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .task-item {
      display: grid;
      grid-template-columns: auto auto 1fr auto;
      gap: 16px;
      align-items: center;
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 16px 20px;
      transition: background 0.2s ease, border-color 0.2s ease, opacity 0.2s ease, transform 0.15s ease;
    }

    .task-item:hover {
      border-color: var(--accent);
      background: var(--surface-hover);
    }

    .task-item.dragging {
      opacity: 0.4;
      transform: scale(0.98);
    }

    .task-item.drag-over {
      border-color: var(--accent);
      box-shadow: 0 0 0 1px var(--accent);
    }

    .drag-handle {
      cursor: grab;
      color: var(--border);
      display: flex;
      align-items: center;
      padding: 2px;
      border-radius: 4px;
      transition: color 0.15s ease;
    }

    .drag-handle:active { cursor: grabbing; }
    .drag-handle:hover { color: var(--text-muted); }

    .task-item.done .drag-handle { opacity: 0.3; }

    .task-checkbox {
      width: 22px;
      height: 22px;
      border: 2px solid var(--border);
      border-radius: 6px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      background: transparent;
      transition: all 0.15s ease;
      flex-shrink: 0;
      color: transparent;
    }

    .task-checkbox:hover { border-color: var(--accent); }

    .task-checkbox.checked {
      background: var(--accent);
      border-color: var(--accent);
      color: var(--bg);
    }

    .task-content {
      display: flex;
      flex-direction: column;
      gap: 4px;
      min-width: 0;
    }

    .task-title {
      font-weight: 500;
      font-size: 1rem;
      transition: all 0.2s ease;
    }

    .task-item.done .task-title {
      text-decoration: line-through;
      color: var(--text-muted);
    }

    .task-notes {
      font-size: 0.875rem;
      color: var(--text-muted);
      line-height: 1.4;
      white-space: pre-wrap;
      word-break: break-word;
    }

    .task-item.done .task-notes { opacity: 0.5; }

    /* Task completion animation */
    .task-item.completing {
      animation: taskComplete 0.6s ease forwards;
    }

    @keyframes taskComplete {
      0% { 
        transform: scale(1);
        opacity: 1;
      }
      15% {
        transform: scale(1.02);
      }
      40% {
        opacity: 1;
        transform: scale(1);
      }
      100% { 
        opacity: 0.6;
        transform: translateX(8px);
      }
    }

    /* Celebration burst */
    .celebration {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      z-index: 1000;
      pointer-events: none;
    }

    .celebration-inner {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 12px;
      animation: celebrationPop 0.8s ease forwards;
    }

    @keyframes celebrationPop {
      0% {
        transform: scale(0);
        opacity: 0;
      }
      20% {
        transform: scale(1.2);
        opacity: 1;
      }
      40% {
        transform: scale(0.95);
      }
      60% {
        transform: scale(1);
        opacity: 1;
      }
      100% {
        transform: scale(0.8);
        opacity: 0;
      }
    }

    .celebration-check {
      width: 72px;
      height: 72px;
      background: var(--accent);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 0 40px rgba(0, 212, 170, 0.5);
    }

    .celebration-check svg {
      width: 36px;
      height: 36px;
      stroke: var(--bg);
      stroke-width: 3;
      fill: none;
      stroke-dasharray: 50;
      stroke-dashoffset: 50;
      animation: checkDraw 0.4s ease 0.15s forwards;
    }

    @keyframes checkDraw {
      to {
        stroke-dashoffset: 0;
      }
    }

    .celebration-text {
      font-weight: 600;
      font-size: 1rem;
      color: var(--accent);
      text-transform: uppercase;
      letter-spacing: 0.1em;
    }

    /* Confetti particles */
    .confetti {
      position: absolute;
      width: 8px;
      height: 8px;
      border-radius: 2px;
    }

    .confetti:nth-child(1) { background: var(--accent); animation: confetti1 0.8s ease forwards; }
    .confetti:nth-child(2) { background: #f0c040; animation: confetti2 0.8s ease forwards; }
    .confetti:nth-child(3) { background: #ff6b9d; animation: confetti3 0.8s ease forwards; }
    .confetti:nth-child(4) { background: #a78bfa; animation: confetti4 0.8s ease forwards; }
    .confetti:nth-child(5) { background: #60a5fa; animation: confetti5 0.8s ease forwards; }
    .confetti:nth-child(6) { background: var(--accent); animation: confetti6 0.8s ease forwards; }

    @keyframes confetti1 { 0% { transform: translate(0, 0) rotate(0deg); opacity: 1; } 100% { transform: translate(-60px, -80px) rotate(200deg); opacity: 0; } }
    @keyframes confetti2 { 0% { transform: translate(0, 0) rotate(0deg); opacity: 1; } 100% { transform: translate(70px, -70px) rotate(-180deg); opacity: 0; } }
    @keyframes confetti3 { 0% { transform: translate(0, 0) rotate(0deg); opacity: 1; } 100% { transform: translate(-50px, 60px) rotate(160deg); opacity: 0; } }
    @keyframes confetti4 { 0% { transform: translate(0, 0) rotate(0deg); opacity: 1; } 100% { transform: translate(60px, 50px) rotate(-200deg); opacity: 0; } }
    @keyframes confetti5 { 0% { transform: translate(0, 0) rotate(0deg); opacity: 1; } 100% { transform: translate(-80px, 20px) rotate(180deg); opacity: 0; } }
    @keyframes confetti6 { 0% { transform: translate(0, 0) rotate(0deg); opacity: 1; } 100% { transform: translate(80px, -30px) rotate(-160deg); opacity: 0; } }

    .task-actions {
      display: flex;
      gap: 8px;
      opacity: 0;
      transition: opacity 0.2s ease;
      flex-shrink: 0;
    }

    .task-item:hover .task-actions { opacity: 1; }

    .task-stats {
      font-size: 0.875rem;
      color: var(--text-muted);
      background: var(--surface);
      border: 1px solid var(--border);
      padding: 8px 16px;
      border-radius: 20px;
    }

    .task-stats strong {
      color: var(--accent);
      font-weight: 600;
    }

    .carryover-banner {
      background: var(--surface);
      border: 1px dashed var(--border);
      border-radius: 10px;
      padding: 16px 20px;
      margin-bottom: 16px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 16px;
    }

    .carryover-banner p {
      font-size: 0.9rem;
      color: var(--text-muted);
    }

    .carryover-banner strong {
      color: var(--text);
    }

    .btn-carryover {
      background: var(--accent-dim);
      color: var(--accent);
      border: 1px solid var(--accent);
      padding: 8px 16px;
      font-size: 0.8rem;
      white-space: nowrap;
    }

    .btn-carryover:hover {
      background: var(--accent);
      color: var(--bg);
    }

    /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
       NOTES
       ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
    .notes-toolbar {
      display: flex;
      align-items: center;
      gap: 4px;
      margin-bottom: 12px;
    }

    .toolbar-btn {
      width: 32px;
      height: 32px;
      border-radius: 6px;
      background: var(--surface);
      border: 1px solid var(--border);
      color: var(--text-muted);
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.15s ease;
    }

    .toolbar-btn:hover {
      border-color: var(--accent);
      color: var(--accent);
    }

    .toolbar-divider {
      width: 1px;
      height: 20px;
      background: var(--border);
      margin: 0 8px;
    }

    .notes-meta {
      margin-left: auto;
      display: flex;
      align-items: center;
      gap: 16px;
      font-size: 0.75rem;
      color: var(--text-muted);
    }

    .notes-meta .word-count {
      opacity: 0.5;
    }

    .notes-meta .save-status {
      transition: color 0.2s ease;
    }

    .notes-meta .save-status.saved {
      color: var(--accent);
    }

    .notes-container {
      position: relative;
    }

    .notes-editor {
      width: 100%;
      min-height: 360px;
      max-height: 70vh;
      padding: 24px;
      font-family: 'JetBrains Mono', monospace;
      font-size: 0.9rem;
      line-height: 1.8;
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 12px;
      color: var(--text);
      outline: none;
      resize: none;
      overflow-y: auto;
      transition: border-color 0.2s ease;
    }

    .notes-editor:focus {
      border-color: var(--accent);
    }

    .notes-editor::placeholder {
      color: var(--text-muted);
      opacity: 0.5;
    }

    .notes-editor.hidden {
      display: none;
    }

    .notes-preview {
      display: none;
      width: 100%;
      min-height: 360px;
      padding: 24px;
      font-size: 0.95rem;
      line-height: 1.7;
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 12px;
      color: var(--text);
    }

    .notes-preview.active {
      display: block;
    }

    .notes-preview:empty::before {
      content: 'Nothing to preview';
      color: var(--text-muted);
      opacity: 0.4;
    }

    .notes-preview p {
      margin-bottom: 0.5em;
    }

    .notes-preview p:last-child {
      margin-bottom: 0;
    }

    .notes-preview strong {
      color: var(--accent);
      font-weight: 600;
    }

    .notes-preview code {
      font-family: 'JetBrains Mono', monospace;
      font-size: 0.85em;
      background: var(--bg);
      border: 1px solid var(--border);
      padding: 2px 6px;
      border-radius: 4px;
      color: var(--accent);
    }

    .notes-preview pre {
      background: var(--bg);
      border: 1px solid var(--border);
      border-radius: 8px;
      padding: 14px 18px;
      margin: 0.5em 0;
      overflow-x: auto;
    }

    .notes-preview pre code {
      background: none;
      border: none;
      padding: 0;
      font-size: 0.85rem;
      line-height: 1.6;
      color: var(--text);
    }

    .notes-preview ul {
      margin: 0.3em 0;
      padding-left: 1.4em;
    }

    .notes-preview li {
      margin-bottom: 0.2em;
    }

    .notes-preview li:last-child {
      margin-bottom: 0;
    }

    .notes-toggle {
      display: flex;
      gap: 4px;
      margin-top: 16px;
      background: var(--surface);
      border-radius: 8px;
      padding: 4px;
      border: 1px solid var(--border);
      width: fit-content;
    }

    .toggle-btn {
      font-family: inherit;
      font-size: 0.8rem;
      font-weight: 500;
      padding: 8px 20px;
      border-radius: 6px;
      border: none;
      cursor: pointer;
      background: transparent;
      color: var(--text-muted);
      transition: all 0.15s ease;
    }

    .toggle-btn:hover { color: var(--text); }

    .toggle-btn.active {
      background: var(--accent);
      color: var(--bg);
    }

    /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
       STATS MODAL
       ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
    .stats-modal {
      max-width: 600px;
      max-height: 85vh;
      overflow-y: auto;
    }

    .stats-header {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 16px;
      margin-bottom: 24px;
    }

    .stats-header h3 {
      margin: 0;
    }

    .stats-period {
      display: flex;
      gap: 4px;
      background: var(--bg);
      border-radius: 6px;
      padding: 3px;
    }

    .stats-period button {
      font-family: inherit;
      font-size: 0.75rem;
      padding: 6px 0;
      width: 70px;
      text-align: center;
      border: none;
      border-radius: 4px;
      background: transparent;
      color: var(--text-muted);
      cursor: pointer;
      transition: all 0.15s ease;
    }

    .stats-period button.active {
      background: var(--surface);
      color: var(--text);
    }

    .stats-period button:hover:not(.active) {
      color: var(--text);
    }

    .stats-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 12px;
      margin-bottom: 28px;
    }

    .stat-card {
      background: var(--bg);
      border-radius: 10px;
      padding: 16px;
      text-align: center;
    }

    .stat-value {
      font-family: 'JetBrains Mono', monospace;
      font-size: 1.5rem;
      font-weight: 600;
      color: var(--accent);
      margin-bottom: 4px;
    }

    .stat-label {
      font-size: 0.7rem;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: var(--text-muted);
    }

    .stats-section {
      margin-bottom: 28px;
    }

    .stats-section:last-child {
      margin-bottom: 0;
    }

    .stats-section-title {
      font-size: 0.75rem;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: var(--text-muted);
      margin-bottom: 14px;
    }

    .stats-bar-list {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .stats-bar-item {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .stats-bar-label {
      width: 140px;
      font-size: 0.85rem;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .stats-bar-track {
      flex: 1;
      height: 8px;
      background: var(--bg);
      border-radius: 4px;
      overflow: hidden;
    }

    .stats-bar-fill {
      height: 100%;
      background: var(--accent);
      border-radius: 4px;
      transition: width 0.4s ease;
    }

    .stats-bar-value {
      font-family: 'JetBrains Mono', monospace;
      font-size: 0.8rem;
      color: var(--text-muted);
      width: 60px;
      text-align: right;
    }

    .stats-empty {
      text-align: center;
      padding: 40px 20px;
      color: var(--text-muted);
    }

    .stats-percentage-list {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .stats-percentage-item {
      position: relative;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 10px 14px;
      background: var(--bg);
      border-radius: 8px;
      overflow: hidden;
    }

    .stats-percentage-bar {
      position: absolute;
      left: 0;
      top: 0;
      bottom: 0;
      background: var(--accent-dim);
      border-radius: 8px;
      z-index: 0;
    }

    .stats-percentage-label {
      position: relative;
      z-index: 1;
      font-size: 0.85rem;
    }

    .stats-percentage-value {
      position: relative;
      z-index: 1;
      font-family: 'JetBrains Mono', monospace;
      font-size: 0.85rem;
      font-weight: 500;
      color: var(--accent);
    }

    .stats-activity {
      display: flex;
      gap: 3px;
      flex-wrap: wrap;
    }

    .activity-day {
      width: 12px;
      height: 12px;
      border-radius: 2px;
      background: var(--bg);
    }

    .activity-day.level-1 { background: rgba(0, 212, 170, 0.25); }
    .activity-day.level-2 { background: rgba(0, 212, 170, 0.5); }
    .activity-day.level-3 { background: rgba(0, 212, 170, 0.75); }
    .activity-day.level-4 { background: var(--accent); }

    /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
       SETTINGS MODAL
       ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
    .settings-section {
      margin-bottom: 24px;
    }

    .settings-section-title {
      font-size: 0.75rem;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: var(--text-muted);
      margin-bottom: 12px;
    }

    .settings-buttons {
      display: flex;
      gap: 12px;
    }

    .settings-buttons .btn {
      flex: 1;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 14px 20px;
    }

    .settings-hint {
      font-size: 0.8rem;
      color: var(--text-muted);
      margin-top: 12px;
      opacity: 0.7;
    }

    /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
       PTO TRACKER
       ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
    .pto-layout {
      display: grid;
      grid-template-columns: 1fr 280px;
      gap: 32px;
    }

    .pto-main {
      display: flex;
      flex-direction: column;
      gap: 28px;
    }

    .pto-stats {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 12px;
    }

    .pto-stat-card {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 20px;
      text-align: center;
    }

    .pto-stat-card.warning {
      border-color: #f59e0b;
      background: rgba(245, 158, 11, 0.1);
    }

    .pto-stat-value {
      font-family: 'JetBrains Mono', monospace;
      font-size: 1.75rem;
      font-weight: 600;
      color: var(--accent);
      margin-bottom: 4px;
    }

    .pto-stat-card.warning .pto-stat-value {
      color: #f59e0b;
    }

    .pto-stat-label {
      font-size: 0.75rem;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      color: var(--text-muted);
    }

    .pto-holiday-alert {
      background: linear-gradient(135deg, var(--accent-dim), transparent);
      border: 1px solid var(--accent);
      border-radius: 12px;
      padding: 16px 20px;
      display: flex;
      align-items: center;
      gap: 16px;
    }

    .pto-holiday-alert:empty {
      display: none;
    }

    .pto-holiday-alert-icon {
      font-size: 1.5rem;
    }

    .pto-holiday-alert-content {
      flex: 1;
    }

    .pto-holiday-alert-title {
      font-weight: 600;
      margin-bottom: 2px;
    }

    .pto-holiday-alert-subtitle {
      font-size: 0.85rem;
      color: var(--text-muted);
    }

    .pto-section {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 24px;
    }

    .pto-section-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }

    .pto-section-header h3 {
      margin: 0;
      font-size: 1rem;
      font-weight: 600;
    }

    .pto-calendar-container {
      margin-bottom: 20px;
    }

    .pto-calendar-header {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 20px;
      margin-bottom: 16px;
    }

    .pto-calendar-header span {
      font-weight: 500;
      min-width: 150px;
      text-align: center;
    }

    .pto-calendar-header button {
      background: var(--bg);
      border: 1px solid var(--border);
      border-radius: 6px;
      padding: 6px 10px;
      cursor: pointer;
      color: var(--text-muted);
      transition: all 0.15s ease;
    }

    .pto-calendar-header button:hover {
      border-color: var(--accent);
      color: var(--accent);
    }

    .pto-calendar {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 4px;
    }

    .pto-calendar-day-header {
      text-align: center;
      font-size: 0.7rem;
      text-transform: uppercase;
      color: var(--text-muted);
      padding: 8px 0;
    }

    .pto-calendar-day {
      aspect-ratio: 1;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.85rem;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.15s ease;
      border: 1px solid transparent;
    }

    .pto-calendar-day:hover:not(.other-month):not(.holiday):not(.used) {
      background: var(--bg);
      border-color: var(--border);
    }

    .pto-calendar-day.other-month {
      color: var(--text-muted);
      opacity: 0.3;
      cursor: default;
    }

    .pto-calendar-day.today {
      border-color: var(--accent);
    }

    .pto-calendar-day.selected {
      background: var(--accent);
      color: var(--bg);
      font-weight: 600;
    }

    .pto-calendar-day.holiday {
      background: rgba(139, 92, 246, 0.2);
      color: #a78bfa;
      cursor: default;
    }

    .pto-calendar-day.used {
      background: rgba(239, 68, 68, 0.2);
      color: #f87171;
      cursor: default;
      text-decoration: line-through;
    }

    .pto-calendar-day.weekend {
      color: var(--text-muted);
      opacity: 0.5;
      cursor: default;
    }

    .pto-selected {
      min-height: 40px;
    }

    .pto-selected-days {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
    }

    .pto-selected-day {
      display: flex;
      align-items: center;
      gap: 6px;
      background: var(--accent-dim);
      border: 1px solid var(--accent);
      color: var(--accent);
      padding: 6px 10px;
      border-radius: 6px;
      font-size: 0.8rem;
    }

    .pto-selected-day button {
      background: none;
      border: none;
      color: var(--accent);
      cursor: pointer;
      padding: 0;
      font-size: 1rem;
      line-height: 1;
      opacity: 0.7;
    }

    .pto-selected-day button:hover {
      opacity: 1;
    }

    .pto-email-section {
      margin-top: 20px;
      padding-top: 20px;
      border-top: 1px solid var(--border);
    }

    .pto-email-section textarea {
      font-family: inherit;
      font-size: 0.9rem;
    }

    .pto-email-actions {
      display: flex;
      gap: 12px;
      margin-top: 12px;
    }

    .pto-confirm-section {
      margin-top: 20px;
      padding-top: 20px;
      border-top: 1px dashed var(--border);
    }

    .pto-confirm-section p {
      font-size: 0.85rem;
      color: var(--text-muted);
      margin-bottom: 12px;
    }

    .pto-history {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .pto-history-empty {
      text-align: center;
      padding: 32px 20px;
      color: var(--text-muted);
    }

    .pto-history-item {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 12px 16px;
      background: var(--bg);
      border-radius: 8px;
    }

    .pto-history-date {
      font-weight: 500;
    }

    .pto-history-type {
      font-size: 0.75rem;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      color: var(--text-muted);
      background: var(--surface);
      padding: 4px 8px;
      border-radius: 4px;
    }

    .pto-history-actions {
      display: flex;
      gap: 8px;
    }

    .pto-sidebar {
      display: flex;
      flex-direction: column;
      gap: 20px;
    }

    .pto-sidebar-section {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 20px;
    }

    .pto-sidebar-section h4 {
      margin: 0 0 16px 0;
      font-size: 0.9rem;
      font-weight: 600;
    }

    .pto-holidays {
      display: flex;
      flex-direction: column;
      gap: 8px;
      max-height: 400px;
      overflow-y: auto;
    }

    .pto-holiday-item {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 10px 12px;
      background: var(--bg);
      border-radius: 8px;
      font-size: 0.85rem;
    }

    .pto-holiday-item.past {
      opacity: 0.4;
    }

    .pto-holiday-item.next {
      border: 1px solid var(--accent);
      background: var(--accent-dim);
    }

    .pto-holiday-date {
      font-family: 'JetBrains Mono', monospace;
      font-size: 0.75rem;
      color: var(--text-muted);
      min-width: 55px;
    }

    .pto-holiday-name {
      flex: 1;
    }

    .pto-holiday-note {
      font-size: 0.7rem;
      color: var(--accent);
    }

    .pto-nudge {
      margin-top: 16px;
      padding: 12px;
      background: rgba(251, 191, 36, 0.1);
      border: 1px dashed #fbbf24;
      border-radius: 8px;
      font-size: 0.85rem;
      color: #fbbf24;
      text-align: center;
    }

    .pto-empty-state {
      text-align: center;
      padding: 48px 24px;
    }

    .pto-empty-state-icon {
      font-size: 3rem;
      margin-bottom: 16px;
      opacity: 0.5;
    }

    .pto-empty-state-title {
      font-size: 1.1rem;
      font-weight: 600;
      margin-bottom: 8px;
    }

    .pto-empty-state-text {
      color: var(--text-muted);
      font-size: 0.9rem;
      margin-bottom: 20px;
    }

    .pto-setup-prompt {
      background: var(--surface);
      border: 2px dashed var(--border);
      border-radius: 16px;
      padding: 48px;
      text-align: center;
      margin-bottom: 24px;
    }

    .pto-setup-prompt-icon {
      font-size: 3rem;
      margin-bottom: 16px;
    }

    .pto-setup-prompt h3 {
      margin-bottom: 12px;
    }

    .pto-setup-prompt p {
      color: var(--text-muted);
      margin-bottom: 24px;
      max-width: 400px;
      margin-left: auto;
      margin-right: auto;
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <div class="brand">
        <span class="brand-dot"></span>
        Workbench
      </div>
      <div class="header-actions">
        <button class="btn btn-ghost btn-sm" onclick="openModal('statsModal')">Stats</button>
        <button class="btn btn-ghost btn-sm" onclick="openModal('settingsModal')">Settings</button>
      </div>
    </header>

    <div class="app-nav-container">
      <nav class="app-nav">
        <button class="app-tab active" onclick="switchApp('timer')">Time Tracker</button>
        <button class="app-tab" onclick="switchApp('tasks')">Tasks</button>
        <button class="app-tab" onclick="switchApp('notes')">Notes</button>
        <button class="app-tab" onclick="switchApp('pto')">PTO</button>
      </nav>
    </div>

    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê TIME TRACKER ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <div id="view-timer" class="app-view active">
      <section class="timer-section">
        <div class="timer-display" id="timerDisplay">00:00:00</div>
        <div class="input-row">
          <div class="input-group">
            <label>Description</label>
            <input type="text" id="description" placeholder="What are you working on?">
          </div>
          <div class="input-group">
            <label>Category</label>
            <select id="category"></select>
          </div>
        </div>
        <div class="timer-controls">
          <button class="btn btn-start" id="startBtn" onclick="startTimer()">Start Timer</button>
          <button class="btn btn-stop" id="stopBtn" onclick="stopTimer()" style="display:none;">Stop &amp; Save</button>
        </div>
      </section>

      <section class="daily-view">
        <div class="daily-header">
          <div class="date-nav">
            <button onclick="changeTimerDate(-1)"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="15 18 9 12 15 6"/></svg></button>
            <span id="timerCurrentDate"></span>
            <button onclick="changeTimerDate(1)"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="9 18 15 12 9 6"/></svg></button>
          </div>
          <div class="daily-header-right">
            <button class="btn btn-ghost btn-sm" onclick="openModal('categoryModal')">Categories</button>
            <div class="total-time" id="totalTime">Total: 00:00:00</div>
          </div>
        </div>
        <div class="category-summary" id="categorySummary"></div>
        <div class="entries-list" id="entriesList"></div>
      </section>
    </div>

    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê TASKS ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <div id="view-tasks" class="app-view">
      <section class="task-input-section">
        <div class="input-group">
          <label>Task</label>
          <input type="text" id="taskTitle" placeholder="What needs to get done?">
        </div>
        <div class="input-group" style="margin-top:12px;">
          <label>Notes (optional)</label>
          <textarea id="taskNotes" placeholder="Extra details, links, context..." rows="3"></textarea>
        </div>
        <button class="btn btn-accent" onclick="addTask()" style="width:100%; margin-top:16px; padding:14px;">Add Task</button>
      </section>

      <section class="daily-view">
        <div class="daily-header">
          <div class="date-nav">
            <button onclick="changeTaskDate(-1)"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="15 18 9 12 15 6"/></svg></button>
            <span id="taskCurrentDate"></span>
            <button onclick="changeTaskDate(1)"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="9 18 15 12 9 6"/></svg></button>
          </div>
          <div class="task-stats" id="taskStats"></div>
        </div>
        <div id="carryoverBanner"></div>
        <div class="task-list" id="taskList"></div>
      </section>
    </div>

    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê NOTES ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <div id="view-notes" class="app-view">
      <section class="daily-view">
        <div class="daily-header">
          <div class="date-nav">
            <button onclick="changeNotesDate(-1)"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="15 18 9 12 15 6"/></svg></button>
            <span id="notesCurrentDate"></span>
            <button onclick="changeNotesDate(1)"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="9 18 15 12 9 6"/></svg></button>
          </div>
        </div>

        <div class="notes-toolbar">
          <button class="toolbar-btn" onclick="formatBold()" title="Bold (Ctrl+B)">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M6 4h8a4 4 0 0 1 4 4 4 4 0 0 1-4 4H6z"/><path d="M6 12h9a4 4 0 0 1 4 4 4 4 0 0 1-4 4H6z"/></svg>
          </button>
          <button class="toolbar-btn" onclick="formatList()" title="Bullet List">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="9" y1="6" x2="20" y2="6"/><line x1="9" y1="12" x2="20" y2="12"/><line x1="9" y1="18" x2="20" y2="18"/><circle cx="4" cy="6" r="1.5" fill="currentColor"/><circle cx="4" cy="12" r="1.5" fill="currentColor"/><circle cx="4" cy="18" r="1.5" fill="currentColor"/></svg>
          </button>
          <button class="toolbar-btn" onclick="formatCode()" title="Code">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="16 18 22 12 16 6"/><polyline points="8 6 2 12 8 18"/></svg>
          </button>
          <div class="notes-meta">
            <span class="word-count" id="wordCount">0 words</span>
            <span class="save-status" id="saveStatus"></span>
          </div>
        </div>

        <div class="notes-container">
          <textarea id="notesEditor" class="notes-editor" placeholder="Start writing..."></textarea>
          <div id="notesPreview" class="notes-preview"></div>
        </div>

        <div class="notes-toggle">
          <button class="toggle-btn active" onclick="setNotesView('write')" data-view="write">Write</button>
          <button class="toggle-btn" onclick="setNotesView('preview')" data-view="preview">Preview</button>
        </div>
      </section>
    </div>

    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê PTO ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <div id="view-pto" class="app-view">
      <div id="ptoSetupPrompt" class="pto-setup-prompt" style="display:none;">
        <div class="pto-setup-prompt-icon">üìÖ</div>
        <h3>Set Up PTO Tracking</h3>
        <p>Track your paid time off, see your remaining balance, and generate PTO request emails.</p>
        <button class="btn btn-accent" onclick="openModal('ptoSetupModal')">Get Started</button>
      </div>
      
      <div id="ptoContent" class="pto-layout" style="display:none;">
        <div class="pto-main">
          <!-- Stats Cards -->
          <div class="pto-stats" id="ptoStats"></div>

          <!-- Holiday Alert -->
          <div class="pto-holiday-alert" id="ptoHolidayAlert"></div>

          <!-- Request Section -->
          <div class="pto-section">
            <div class="pto-section-header">
              <h3>Request Time Off</h3>
              <button class="btn btn-ghost btn-sm" onclick="openModal('ptoSettingsModal')">Settings</button>
            </div>
            
            <div class="pto-calendar-container">
              <div class="pto-calendar-header">
                <button onclick="changePtoMonth(-1)"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="15 18 9 12 15 6"/></svg></button>
                <span id="ptoCalendarMonth"></span>
                <button onclick="changePtoMonth(1)"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="9 18 15 12 9 6"/></svg></button>
              </div>
              <div class="pto-calendar" id="ptoCalendar"></div>
            </div>

            <div class="pto-selected" id="ptoSelected"></div>
            
            <div class="pto-email-section" id="ptoEmailSection" style="display:none;">
              <div class="input-group">
                <label>Email Preview</label>
                <textarea id="ptoEmailPreview" rows="6" readonly></textarea>
              </div>
              <div class="pto-email-actions">
                <button class="btn btn-ghost" onclick="copyPtoEmail()">Copy Email</button>
                <button class="btn btn-accent" onclick="openPtoEmailClient()">Open in Mail</button>
              </div>
              <div class="pto-confirm-section" id="ptoConfirmSection">
                <p>After sending the email and receiving approval, confirm to log these days:</p>
                <button class="btn btn-accent" onclick="confirmPtoRequest()">Confirm PTO Sent & Approved</button>
              </div>
            </div>
          </div>

          <!-- PTO History -->
          <div class="pto-section">
            <div class="pto-section-header">
              <h3>2026 PTO History</h3>
              <button class="btn btn-ghost btn-sm" onclick="openModal('ptoManualEntryModal')">+ Add Past Entry</button>
            </div>
            <div class="pto-history" id="ptoHistory"></div>
          </div>
        </div>

        <div class="pto-sidebar">
          <!-- Upcoming Holidays -->
          <div class="pto-sidebar-section">
            <h4>2026 Holidays</h4>
            <div class="pto-holidays" id="ptoHolidays"></div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê MODALS ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->

  <div class="modal-overlay" id="editModal">
    <div class="modal">
      <button class="modal-close" onclick="closeModal('editModal')"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg></button>
      <h3>Edit Entry</h3>
      <div class="input-group"><label>Description</label><input type="text" id="editDescription"></div>
      <div class="input-group"><label>Category</label><select id="editCategory"></select></div>
      <div class="input-group"><label>Date</label><input type="date" id="editDate"></div>
      <div class="time-inputs">
        <div class="input-group"><label>Start Time</label><input type="time" id="editStartTime" step="1"></div>
        <div class="input-group"><label>End Time</label><input type="time" id="editEndTime" step="1"></div>
      </div>
      <div class="modal-actions">
        <button class="btn btn-ghost" onclick="closeModal('editModal')">Cancel</button>
        <button class="btn btn-accent" onclick="saveEdit()">Save Changes</button>
      </div>
    </div>
  </div>

  <div class="modal-overlay" id="categoryModal">
    <div class="modal">
      <button class="modal-close" onclick="closeModal('categoryModal')"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg></button>
      <h3>Manage Categories</h3>
      <div class="category-list" id="categoryList"></div>
      <div class="add-category">
        <input type="text" id="newCategory" placeholder="New category name">
        <button class="btn btn-accent btn-sm" onclick="addCategory()">Add</button>
      </div>
      <div class="modal-actions">
        <button class="btn btn-ghost" onclick="closeModal('categoryModal')">Done</button>
      </div>
    </div>
  </div>

  <div class="modal-overlay" id="editTaskModal">
    <div class="modal">
      <button class="modal-close" onclick="closeModal('editTaskModal')"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg></button>
      <h3>Edit Task</h3>
      <div class="input-group"><label>Task</label><input type="text" id="editTaskTitle"></div>
      <div class="input-group"><label>Notes</label><textarea id="editTaskNotes" rows="3"></textarea></div>
      <div class="input-group"><label>Date</label><input type="date" id="editTaskDate"></div>
      <div class="modal-actions">
        <button class="btn btn-ghost" onclick="closeModal('editTaskModal')">Cancel</button>
        <button class="btn btn-accent" onclick="saveTaskEdit()">Save Changes</button>
      </div>
    </div>
  </div>

  <div class="modal-overlay" id="statsModal">
    <div class="modal stats-modal">
      <button class="modal-close" onclick="closeModal('statsModal')"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg></button>
      <div class="stats-header">
        <h3>Stats</h3>
        <div class="stats-period">
          <button class="active" onclick="setStatsPeriod('week')">Week</button>
          <button onclick="setStatsPeriod('month')">Month</button>
          <button onclick="setStatsPeriod('all')">All Time</button>
        </div>
      </div>
      <div id="statsContent"></div>
      <div class="modal-actions">
        <button class="btn btn-ghost" onclick="closeModal('statsModal')">Close</button>
      </div>
    </div>
  </div>

  <div class="modal-overlay" id="settingsModal">
    <div class="modal">
      <button class="modal-close" onclick="closeModal('settingsModal')"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg></button>
      <h3>Settings</h3>
      <div class="settings-section">
        <div class="settings-section-title">Data Management</div>
        <div class="settings-buttons">
          <button class="btn btn-ghost" onclick="document.getElementById('importFile').click()">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="margin-right:8px;"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
            Import Data
          </button>
          <button class="btn btn-ghost" onclick="exportData()">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="margin-right:8px;"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/></svg>
            Export Data
          </button>
        </div>
        <input type="file" id="importFile" accept=".json" style="display: none;" onchange="importData(event)">
        <p class="settings-hint">Export creates a backup of all your time entries, tasks, notes, and categories.</p>
      </div>
      <div class="modal-actions">
        <button class="btn btn-ghost" onclick="closeModal('settingsModal')">Close</button>
      </div>
    </div>
  </div>

  <div class="modal-overlay" id="ptoSettingsModal">
    <div class="modal">
      <button class="modal-close" onclick="closeModal('ptoSettingsModal')"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg></button>
      <h3>PTO Settings</h3>
      <div class="settings-section">
        <div class="settings-section-title">Your Information</div>
        <div class="input-group">
          <label>Year Employment Started</label>
          <select id="ptoStartYear"></select>
        </div>
        <div class="input-group">
          <label>Rollover Days from Last Year</label>
          <input type="number" id="ptoRollover" min="0" max="8" value="8">
        </div>
        <div class="input-group">
          <label>Your Initials (for email subject)</label>
          <input type="text" id="ptoInitials" placeholder="e.g., MP" maxlength="5">
        </div>
        <div class="input-group">
          <label>Supervisor Name</label>
          <input type="text" id="ptoSupervisor" placeholder="e.g., Paul">
        </div>
        <div class="input-group">
          <label>Supervisor Email</label>
          <input type="email" id="ptoSupervisorEmail" placeholder="e.g., paul@company.com">
        </div>
        <div class="input-group">
          <label style="display:flex;align-items:center;gap:8px;cursor:pointer;">
            <input type="checkbox" id="ptoExcludeRollover" checked style="width:auto;">
            <span>Exclude rollover days from percentage calculation</span>
          </label>
        </div>
      </div>
      <div class="settings-section">
        <div class="settings-section-title">PTO Data</div>
        <div class="settings-buttons">
          <button class="btn btn-ghost" onclick="document.getElementById('ptoImportFile').click()">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="margin-right:8px;"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
            Import PTO
          </button>
          <button class="btn btn-ghost" onclick="exportPtoData()">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="margin-right:8px;"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/></svg>
            Export PTO
          </button>
        </div>
        <input type="file" id="ptoImportFile" accept=".json" style="display: none;" onchange="importPtoData(event)">
        <p class="settings-hint">Import format: { "settings": {...}, "entries": [...], "holidays": [...] }</p>
      </div>
      <div class="modal-actions">
        <button class="btn btn-ghost" onclick="closeModal('ptoSettingsModal')">Cancel</button>
        <button class="btn btn-accent" onclick="savePtoSettings()">Save Settings</button>
      </div>
    </div>
  </div>

  <div class="modal-overlay" id="ptoManualEntryModal">
    <div class="modal">
      <button class="modal-close" onclick="closeModal('ptoManualEntryModal')"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg></button>
      <h3>Add Past PTO Entry</h3>
      <div class="input-group">
        <label>Date</label>
        <input type="date" id="ptoManualDate">
      </div>
      <div class="input-group">
        <label>Type</label>
        <select id="ptoManualType">
          <option value="vacation">Vacation</option>
          <option value="sick">Sick</option>
        </select>
      </div>
      <div class="input-group">
        <label>Notes (optional)</label>
        <input type="text" id="ptoManualNotes" placeholder="e.g., Doctor appointment">
      </div>
      <div class="modal-actions">
        <button class="btn btn-ghost" onclick="closeModal('ptoManualEntryModal')">Cancel</button>
        <button class="btn btn-accent" onclick="addManualPtoEntry()">Add Entry</button>
      </div>
    </div>
  </div>

  <div class="modal-overlay" id="ptoSetupModal">
    <div class="modal">
      <button class="modal-close" onclick="closeModal('ptoSetupModal')"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg></button>
      <h3>Set Up PTO Tracking</h3>
      <p style="color: var(--text-muted); margin-bottom: 20px;">Let's configure your PTO settings to get started.</p>
      <div class="input-group">
        <label>Year Employment Started</label>
        <select id="ptoSetupStartYear"></select>
      </div>
      <div class="input-group">
        <label>Rollover Days from Last Year (max 8)</label>
        <input type="number" id="ptoSetupRollover" min="0" max="8" value="8">
      </div>
      <div class="input-group">
        <label>Your Initials</label>
        <input type="text" id="ptoSetupInitials" placeholder="e.g., MP" maxlength="5">
      </div>
      <div class="input-group">
        <label>Supervisor Name</label>
        <input type="text" id="ptoSetupSupervisor" placeholder="e.g., Paul">
      </div>
      <div class="input-group">
        <label>Supervisor Email</label>
        <input type="email" id="ptoSetupSupervisorEmail" placeholder="e.g., paul@company.com">
      </div>
      <div class="modal-actions">
        <button class="btn btn-accent" onclick="completePtoSetup()">Save & Get Started</button>
      </div>
    </div>
  </div>

  <script>
    /* ‚îÄ‚îÄ Shared State ‚îÄ‚îÄ */
    let timerInterval = null;
    let startTime = null;
    let currentEditId = null;
    let currentEditTaskId = null;
    let timerViewDate = new Date();
    let taskViewDate = new Date();

    function getDateKey(d) { return d.toISOString().split('T')[0]; }

    function formatTime(ms) {
      const s = Math.floor(ms / 1000);
      return `${String(Math.floor(s/3600)).padStart(2,'0')}:${String(Math.floor((s%3600)/60)).padStart(2,'0')}:${String(s%60).padStart(2,'0')}`;
    }

    function formatTimeShort(d) {
      return d.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit', hour12: true });
    }

    function formatDateLabel(d) {
      return d.toLocaleDateString('en-US', { weekday: 'long', month: 'short', day: 'numeric' });
    }

    function openModal(id) { document.getElementById(id).classList.add('active'); }
    function closeModal(id) { document.getElementById(id).classList.remove('active'); }

    function esc(str) {
      const d = document.createElement('div');
      d.textContent = str;
      return d.innerHTML;
    }

    /* ‚îÄ‚îÄ App Switcher ‚îÄ‚îÄ */
    function switchApp(app) {
      document.querySelectorAll('.app-tab').forEach(t => t.classList.remove('active'));
      document.querySelectorAll('.app-view').forEach(v => v.classList.remove('active'));
      document.querySelector(`[onclick="switchApp('${app}')"]`).classList.add('active');
      document.getElementById(`view-${app}`).classList.add('active');
      
      if (app === 'pto') {
        const settings = getPtoSettings();
        if (settings) {
          renderPto();
        } else {
          initPto();
        }
      }
    }

    /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
       TIME TRACKER
       ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
    const defaultCategories = ['Code Review', 'Technical Assistance', 'Development', 'Meetings'];

    function getCategories() { return JSON.parse(localStorage.getItem('wb_categories')) || defaultCategories; }
    function getEntries() { return JSON.parse(localStorage.getItem('wb_timeEntries')) || []; }

    function updateCategorySelect() {
      const cats = getCategories().slice().sort((a, b) => a.localeCompare(b));
      ['category','editCategory'].forEach(id => {
        document.getElementById(id).innerHTML = cats.map(c => `<option value="${esc(c)}">${esc(c)}</option>`).join('');
      });
    }

    function renderCategoryList() {
      const cats = getCategories().slice().sort((a, b) => a.localeCompare(b));
      document.getElementById('categoryList').innerHTML = cats.map(c => `
        <div class="category-tag"><span>${esc(c)}</span><button onclick="removeCategory('${esc(c)}')">&times;</button></div>
      `).join('');
    }

    function addCategory() {
      const input = document.getElementById('newCategory');
      const name = input.value.trim();
      if (!name) return;
      const cats = getCategories();
      if (!cats.includes(name)) {
        cats.push(name);
        localStorage.setItem('wb_categories', JSON.stringify(cats));
        updateCategorySelect();
        renderCategoryList();
      }
      input.value = '';
    }

    function removeCategory(name) {
      localStorage.setItem('wb_categories', JSON.stringify(getCategories().filter(c => c !== name)));
      updateCategorySelect();
      renderCategoryList();
    }

    function updateTimerDisplay() {
      document.getElementById('timerDisplay').textContent = formatTime(Date.now() - startTime.getTime());
    }

    function startTimer() {
      const desc = document.getElementById('description').value.trim();
      if (!desc) { document.getElementById('description').focus(); return; }
      startTime = new Date();
      localStorage.setItem('wb_runningTimer', JSON.stringify({
        startTime: startTime.toISOString(),
        description: desc,
        category: document.getElementById('category').value
      }));
      resumeTimer();
    }

    function resumeTimer() {
      document.getElementById('timerDisplay').classList.add('active');
      document.getElementById('startBtn').style.display = 'none';
      document.getElementById('stopBtn').style.display = 'block';
      updateTimerDisplay();
      timerInterval = setInterval(updateTimerDisplay, 1000);
    }

    function stopTimer() {
      clearInterval(timerInterval);
      const running = JSON.parse(localStorage.getItem('wb_runningTimer'));
      const entries = getEntries();
      entries.push({
        id: Date.now().toString(),
        description: running.description,
        category: running.category,
        startTime: running.startTime,
        endTime: new Date().toISOString()
      });
      localStorage.setItem('wb_timeEntries', JSON.stringify(entries));
      localStorage.removeItem('wb_runningTimer');
      document.getElementById('timerDisplay').classList.remove('active');
      document.getElementById('timerDisplay').textContent = '00:00:00';
      document.getElementById('startBtn').style.display = 'block';
      document.getElementById('stopBtn').style.display = 'none';
      document.getElementById('description').value = '';
      renderTimeEntries();
    }

    function renderTimeEntries() {
      const dateKey = getDateKey(timerViewDate);
      const entries = getEntries().filter(e => getDateKey(new Date(e.startTime)) === dateKey)
        .sort((a,b) => new Date(a.startTime) - new Date(b.startTime));

      const container = document.getElementById('entriesList');
      const summary = document.getElementById('categorySummary');
      document.getElementById('timerCurrentDate').textContent = formatDateLabel(timerViewDate);

      if (!entries.length) {
        container.innerHTML = `<div class="empty-state"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg><p>No entries for this day</p></div>`;
        summary.innerHTML = '';
        document.getElementById('totalTime').textContent = 'Total: 00:00:00';
        return;
      }

      let totalMs = 0;
      const catTotals = {};
      entries.forEach(e => { const d = new Date(e.endTime) - new Date(e.startTime); totalMs += d; catTotals[e.category] = (catTotals[e.category]||0) + d; });

      summary.innerHTML = Object.entries(catTotals).sort((a,b) => b[1]-a[1]).map(([cat,ms]) => `
        <div class="summary-card">
          <div class="summary-card-label">${esc(cat)}</div>
          <div class="summary-card-time">${formatTime(ms)}</div>
          <div class="summary-card-bar"><div class="summary-card-bar-fill" style="width:${ms/totalMs*100}%"></div></div>
        </div>`).join('');

      container.innerHTML = entries.map(e => {
        const s = new Date(e.startTime), en = new Date(e.endTime);
        return `<div class="entry">
          <div class="entry-time">${formatTimeShort(s)} ‚Äì ${formatTimeShort(en)}</div>
          <div class="entry-details"><div class="entry-description">${esc(e.description)}</div><div class="entry-category">${esc(e.category)}</div></div>
          <div class="entry-duration">${formatTime(en - s)}</div>
          <div class="entry-actions">
            <button class="btn-icon resume" onclick="resumeEntry('${e.id}')" title="Continue this task"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="5 3 19 12 5 21 5 3"/></svg></button>
            <button class="btn-icon" onclick="openTimeEdit('${e.id}')" title="Edit"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/></svg></button>
            <button class="btn-icon danger" onclick="deleteTimeEntry('${e.id}')" title="Delete"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/></svg></button>
          </div>
        </div>`;
      }).join('');

      document.getElementById('totalTime').textContent = `Total: ${formatTime(totalMs)}`;
    }

    function changeTimerDate(delta) { timerViewDate.setDate(timerViewDate.getDate() + delta); renderTimeEntries(); }

    function openTimeEdit(id) {
      const e = getEntries().find(x => x.id === id);
      if (!e) return;
      currentEditId = id;
      document.getElementById('editDescription').value = e.description;
      document.getElementById('editCategory').value = e.category;
      const s = new Date(e.startTime), en = new Date(e.endTime);
      document.getElementById('editDate').value = getDateKey(s);
      document.getElementById('editStartTime').value = `${String(s.getHours()).padStart(2,'0')}:${String(s.getMinutes()).padStart(2,'0')}:${String(s.getSeconds()).padStart(2,'0')}`;
      document.getElementById('editEndTime').value = `${String(en.getHours()).padStart(2,'0')}:${String(en.getMinutes()).padStart(2,'0')}:${String(en.getSeconds()).padStart(2,'0')}`;
      openModal('editModal');
    }

    function saveEdit() {
      const entries = getEntries();
      const idx = entries.findIndex(e => e.id === currentEditId);
      if (idx === -1) return;
      const dv = document.getElementById('editDate').value;
      const sp = document.getElementById('editStartTime').value.split(':');
      const ep = document.getElementById('editEndTime').value.split(':');
      const sd = new Date(dv+'T00:00:00'); sd.setHours(+sp[0],+sp[1],+(sp[2]||0));
      const ed = new Date(dv+'T00:00:00'); ed.setHours(+ep[0],+ep[1],+(ep[2]||0));
      entries[idx] = { ...entries[idx], description: document.getElementById('editDescription').value, category: document.getElementById('editCategory').value, startTime: sd.toISOString(), endTime: ed.toISOString() };
      localStorage.setItem('wb_timeEntries', JSON.stringify(entries));
      closeModal('editModal');
      renderTimeEntries();
    }

    function deleteTimeEntry(id) {
      if (!confirm('Delete this entry?')) return;
      localStorage.setItem('wb_timeEntries', JSON.stringify(getEntries().filter(e => e.id !== id)));
      renderTimeEntries();
    }

    function resumeEntry(id) {
      // Don't resume if timer is already running
      if (localStorage.getItem('wb_runningTimer')) {
        alert('A timer is already running. Stop it first before resuming another task.');
        return;
      }
      
      const entry = getEntries().find(e => e.id === id);
      if (!entry) return;
      
      // Start a new timer with the same description and category
      startTime = new Date();
      document.getElementById('description').value = entry.description;
      document.getElementById('category').value = entry.category;
      
      localStorage.setItem('wb_runningTimer', JSON.stringify({
        startTime: startTime.toISOString(),
        description: entry.description,
        category: entry.category
      }));
      
      resumeTimer();
      
      // Scroll to top to show the running timer
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
       TASKS
       ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
    function getTasks() { return JSON.parse(localStorage.getItem('wb_tasks')) || []; }
    function saveTasks(t) { localStorage.setItem('wb_tasks', JSON.stringify(t)); }

    function addTask() {
      const title = document.getElementById('taskTitle').value.trim();
      if (!title) { document.getElementById('taskTitle').focus(); return; }
      const tasks = getTasks();
      const dayTasks = tasks.filter(t => t.date === getDateKey(taskViewDate) && !t.done);
      const maxOrder = dayTasks.length ? Math.max(...dayTasks.map(t => t.order || 0)) : -1;
      tasks.push({ id: Date.now().toString(), title, notes: document.getElementById('taskNotes').value.trim(), date: getDateKey(taskViewDate), done: false, order: maxOrder + 1, createdAt: new Date().toISOString() });
      saveTasks(tasks);
      document.getElementById('taskTitle').value = '';
      document.getElementById('taskNotes').value = '';
      renderTasks();
    }

    function toggleTask(id) {
      const tasks = getTasks();
      const t = tasks.find(x => x.id === id);
      if (!t) return;
      
      const wasUndone = !t.done;
      t.done = !t.done;
      saveTasks(tasks);
      
      // If completing (not uncompleting), show celebration
      if (wasUndone) {
        const taskEl = document.querySelector(`[data-task-id="${id}"]`);
        if (taskEl) {
          taskEl.classList.add('completing');
        }
        showCelebration();
        
        // Re-render after animation
        setTimeout(() => {
          renderTasks();
        }, 600);
      } else {
        renderTasks();
      }
    }

    function showCelebration() {
      const celebration = document.createElement('div');
      celebration.className = 'celebration';
      celebration.innerHTML = `
        <div class="celebration-inner">
          <div class="confetti"></div>
          <div class="confetti"></div>
          <div class="confetti"></div>
          <div class="confetti"></div>
          <div class="confetti"></div>
          <div class="confetti"></div>
          <div class="celebration-check">
            <svg viewBox="0 0 24 24"><polyline points="20 6 9 17 4 12"/></svg>
          </div>
          <div class="celebration-text">Done!</div>
        </div>
      `;
      document.body.appendChild(celebration);
      
      setTimeout(() => {
        celebration.remove();
      }, 900);
    }

    function deleteTask(id) {
      if (!confirm('Delete this task?')) return;
      saveTasks(getTasks().filter(t => t.id !== id));
      renderTasks();
    }

    function openTaskEdit(id) {
      const t = getTasks().find(x => x.id === id);
      if (!t) return;
      currentEditTaskId = id;
      document.getElementById('editTaskTitle').value = t.title;
      document.getElementById('editTaskNotes').value = t.notes || '';
      document.getElementById('editTaskDate').value = t.date;
      openModal('editTaskModal');
    }

    function saveTaskEdit() {
      const tasks = getTasks();
      const idx = tasks.findIndex(t => t.id === currentEditTaskId);
      if (idx === -1) return;
      tasks[idx] = { ...tasks[idx], title: document.getElementById('editTaskTitle').value.trim(), notes: document.getElementById('editTaskNotes').value.trim(), date: document.getElementById('editTaskDate').value };
      saveTasks(tasks);
      closeModal('editTaskModal');
      renderTasks();
    }

    function renderTasks() {
      const dateKey = getDateKey(taskViewDate);
      const allTasks = getTasks();
      const tasks = allTasks.filter(t => t.date === dateKey);
      const container = document.getElementById('taskList');
      const bannerContainer = document.getElementById('carryoverBanner');
      document.getElementById('taskCurrentDate').textContent = formatDateLabel(taskViewDate);

      const done = tasks.filter(t => t.done).length;
      document.getElementById('taskStats').innerHTML = tasks.length ? `<strong>${done}</strong> / ${tasks.length} done` : 'No tasks';

      // Check for past unfinished tasks (only show banner when viewing today)
      const todayKey = getDateKey(new Date());
      const pastUnfinished = allTasks.filter(t => !t.done && t.date < todayKey);
      
      if (dateKey === todayKey && pastUnfinished.length > 0) {
        bannerContainer.innerHTML = `
          <div class="carryover-banner">
            <p><strong>${pastUnfinished.length}</strong> unfinished task${pastUnfinished.length === 1 ? '' : 's'} from previous days</p>
            <button class="btn btn-carryover" onclick="carryOverTasks()">Move to Today</button>
          </div>`;
      } else {
        bannerContainer.innerHTML = '';
      }

      if (!tasks.length) {
        container.innerHTML = `<div class="empty-state"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 11l3 3L22 4"/><path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"/></svg><p>No tasks for this day</p></div>`;
        return;
      }

      // Ensure all tasks have an order, sort undone by order, done after
      tasks.forEach((t, i) => { if (t.order === undefined) t.order = i; });
      const undone = tasks.filter(t => !t.done).sort((a, b) => a.order - b.order);
      const doneList = tasks.filter(t => t.done).sort((a, b) => a.order - b.order);
      const sorted = [...undone, ...doneList];

      container.innerHTML = sorted.map(t => `
        <div class="task-item ${t.done ? 'done' : ''}" draggable="${!t.done}" data-task-id="${t.id}"
             ondragstart="onTaskDragStart(event)" ondragend="onTaskDragEnd(event)"
             ondragover="onTaskDragOver(event)" ondragleave="onTaskDragLeave(event)" ondrop="onTaskDrop(event)">
          <div class="drag-handle" ${t.done ? '' : 'title="Drag to reorder"'}>
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="9" cy="6" r="1.5"/><circle cx="15" cy="6" r="1.5"/>
              <circle cx="9" cy="12" r="1.5"/><circle cx="15" cy="12" r="1.5"/>
              <circle cx="9" cy="18" r="1.5"/><circle cx="15" cy="18" r="1.5"/>
            </svg>
          </div>
          <button class="task-checkbox ${t.done ? 'checked' : ''}" onclick="toggleTask('${t.id}')">
            ${t.done ? '<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><polyline points="20 6 9 17 4 12"/></svg>' : ''}
          </button>
          <div class="task-content">
            <div class="task-title">${esc(t.title)}</div>
            ${t.notes ? `<div class="task-notes">${esc(t.notes)}</div>` : ''}
          </div>
          <div class="task-actions">
            <button class="btn-icon" onclick="openTaskEdit('${t.id}')"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/></svg></button>
            <button class="btn-icon danger" onclick="deleteTask('${t.id}')"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/></svg></button>
          </div>
        </div>`).join('');
    }

    function carryOverTasks() {
      const tasks = getTasks();
      const todayKey = getDateKey(new Date());
      const todayTasks = tasks.filter(t => t.date === todayKey && !t.done);
      const maxOrder = todayTasks.length ? Math.max(...todayTasks.map(t => t.order || 0)) : -1;
      
      let orderOffset = maxOrder + 1;
      tasks.forEach(t => {
        if (!t.done && t.date < todayKey) {
          t.date = todayKey;
          t.order = orderOffset++;
        }
      });
      
      saveTasks(tasks);
      renderTasks();
    }

    /* ‚îÄ‚îÄ Task Drag & Drop ‚îÄ‚îÄ */
    let draggedTaskId = null;

    function onTaskDragStart(e) {
      draggedTaskId = e.currentTarget.dataset.taskId;
      e.currentTarget.classList.add('dragging');
      e.dataTransfer.effectAllowed = 'move';
    }

    function onTaskDragEnd(e) {
      draggedTaskId = null;
      e.currentTarget.classList.remove('dragging');
      document.querySelectorAll('.task-item.drag-over').forEach(el => el.classList.remove('drag-over'));
    }

    function onTaskDragOver(e) {
      e.preventDefault();
      const target = e.currentTarget;
      const targetId = target.dataset.taskId;
      if (targetId === draggedTaskId) return;
      // Only allow dropping on undone tasks
      if (target.classList.contains('done')) return;
      e.dataTransfer.dropEffect = 'move';
      target.classList.add('drag-over');
    }

    function onTaskDragLeave(e) {
      e.currentTarget.classList.remove('drag-over');
    }

    function onTaskDrop(e) {
      e.preventDefault();
      const targetEl = e.currentTarget;
      targetEl.classList.remove('drag-over');
      const targetId = targetEl.dataset.taskId;
      if (!draggedTaskId || targetId === draggedTaskId) return;

      const tasks = getTasks();
      const dateKey = getDateKey(taskViewDate);
      const dayUndone = tasks.filter(t => t.date === dateKey && !t.done);
      dayUndone.forEach((t, i) => { if (t.order === undefined) t.order = i; });
      dayUndone.sort((a, b) => a.order - b.order);

      const fromIdx = dayUndone.findIndex(t => t.id === draggedTaskId);
      const toIdx = dayUndone.findIndex(t => t.id === targetId);
      if (fromIdx === -1 || toIdx === -1) return;

      // Reorder
      const [moved] = dayUndone.splice(fromIdx, 1);
      dayUndone.splice(toIdx, 0, moved);

      // Reassign order values
      dayUndone.forEach((t, i) => { t.order = i; });

      // Write back to full tasks array
      const orderMap = {};
      dayUndone.forEach(t => { orderMap[t.id] = t.order; });
      tasks.forEach(t => { if (orderMap[t.id] !== undefined) t.order = orderMap[t.id]; });

      saveTasks(tasks);
      renderTasks();
    }

    function changeTaskDate(delta) { taskViewDate.setDate(taskViewDate.getDate() + delta); renderTasks(); }

    /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
       NOTES
       ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
    let notesViewDate = new Date();
    let notesView = 'write';
    let saveTimeout = null;

    function getNotes() { return JSON.parse(localStorage.getItem('wb_notes')) || {}; }
    function saveNotes(notes) { localStorage.setItem('wb_notes', JSON.stringify(notes)); }

    function renderNotes() {
      document.getElementById('notesCurrentDate').textContent = formatDateLabel(notesViewDate);
      const dateKey = getDateKey(notesViewDate);
      const notes = getNotes();
      const content = notes[dateKey] || '';
      
      const editor = document.getElementById('notesEditor');
      editor.value = content;
      autoExpandEditor();
      updateWordCount();
      updateNotesPreview();
      updateSaveStatus('');
    }

    function autoExpandEditor() {
      const editor = document.getElementById('notesEditor');
      editor.style.height = 'auto';
      const maxHeight = window.innerHeight * 0.7;
      editor.style.height = Math.min(maxHeight, Math.max(360, editor.scrollHeight)) + 'px';
    }

    function updateWordCount() {
      const content = document.getElementById('notesEditor').value.trim();
      const words = content ? content.split(/\s+/).length : 0;
      document.getElementById('wordCount').textContent = words === 1 ? '1 word' : `${words} words`;
    }

    function updateNotesPreview() {
      const content = document.getElementById('notesEditor').value;
      const preview = document.getElementById('notesPreview');
      preview.innerHTML = parseMarkdown(content);
    }

    function parseMarkdown(text) {
      if (!text.trim()) return '';
      
      // Escape HTML
      let html = text.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;');
      
      // Code blocks (``` ... ```)
      html = html.replace(/```([\s\S]*?)```/g, '<pre><code>$1</code></pre>');
      
      // Inline code (`code`)
      html = html.replace(/`([^`]+)`/g, '<code>$1</code>');
      
      // Bold (**text** or __text__)
      html = html.replace(/\*\*(.+?)\*\*/g, '<strong>$1</strong>');
      html = html.replace(/__(.+?)__/g, '<strong>$1</strong>');
      
      // Lists (- item or * item)
      const lines = html.split('\n');
      let inList = false;
      let result = [];
      
      for (let line of lines) {
        const listMatch = line.match(/^[\-\*]\s+(.+)$/);
        if (listMatch) {
          if (!inList) { result.push('<ul>'); inList = true; }
          result.push(`<li>${listMatch[1]}</li>`);
        } else {
          if (inList) { result.push('</ul>'); inList = false; }
          if (line.trim()) {
            result.push(`<p>${line}</p>`);
          }
        }
      }
      if (inList) result.push('</ul>');
      
      return result.join('');
    }

    function onNotesInput() {
      autoExpandEditor();
      updateWordCount();
      
      // Debounce save
      clearTimeout(saveTimeout);
      updateSaveStatus('Saving...');
      
      saveTimeout = setTimeout(() => {
        const dateKey = getDateKey(notesViewDate);
        const notes = getNotes();
        const content = document.getElementById('notesEditor').value;
        
        if (content.trim()) {
          notes[dateKey] = content;
        } else {
          delete notes[dateKey];
        }
        
        saveNotes(notes);
        updateSaveStatus('Saved');
        updateNotesPreview();
      }, 500);
    }

    function updateSaveStatus(status) {
      const el = document.getElementById('saveStatus');
      el.textContent = status;
      el.className = 'save-status' + (status === 'Saved' ? ' saved' : '');
    }

    function setNotesView(view) {
      notesView = view;
      document.querySelectorAll('.toggle-btn').forEach(b => {
        b.classList.toggle('active', b.dataset.view === view);
      });
      
      const editor = document.getElementById('notesEditor');
      const preview = document.getElementById('notesPreview');
      
      if (view === 'write') {
        editor.classList.remove('hidden');
        preview.classList.remove('active');
      } else {
        editor.classList.add('hidden');
        preview.classList.add('active');
        updateNotesPreview();
      }
    }

    function changeNotesDate(delta) {
      notesViewDate.setDate(notesViewDate.getDate() + delta);
      setNotesView('write'); // Reset to write view when changing days
      renderNotes();
    }

    // Formatting helpers
    function formatBold() {
      const editor = document.getElementById('notesEditor');
      wrapSelection(editor, '**', '**');
    }

    function formatList() {
      const editor = document.getElementById('notesEditor');
      const start = editor.selectionStart;
      const lineStart = editor.value.lastIndexOf('\n', start - 1) + 1;
      editor.setSelectionRange(lineStart, lineStart);
      insertText(editor, '- ');
    }

    function formatCode() {
      const editor = document.getElementById('notesEditor');
      const selected = editor.value.substring(editor.selectionStart, editor.selectionEnd);
      if (selected.includes('\n')) {
        wrapSelection(editor, '```\n', '\n```');
      } else {
        wrapSelection(editor, '`', '`');
      }
    }

    function wrapSelection(textarea, before, after) {
      const start = textarea.selectionStart;
      const end = textarea.selectionEnd;
      const text = textarea.value;
      const selected = text.substring(start, end);
      
      textarea.value = text.substring(0, start) + before + selected + after + text.substring(end);
      textarea.selectionStart = start + before.length;
      textarea.selectionEnd = start + before.length + selected.length;
      textarea.focus();
      onNotesInput();
    }

    function insertText(textarea, text) {
      const start = textarea.selectionStart;
      const val = textarea.value;
      textarea.value = val.substring(0, start) + text + val.substring(start);
      textarea.selectionStart = textarea.selectionEnd = start + text.length;
      textarea.focus();
      onNotesInput();
    }

    // Keyboard shortcut for bold
    document.addEventListener('keydown', e => {
      if ((e.ctrlKey || e.metaKey) && e.key === 'b' && document.activeElement.id === 'notesEditor') {
        e.preventDefault();
        formatBold();
      }
    });

    /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
       STATS
       ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
    let statsPeriod = 'week';

    function setStatsPeriod(period) {
      statsPeriod = period;
      document.querySelectorAll('.stats-period button').forEach(b => {
        b.classList.toggle('active', b.textContent.toLowerCase().includes(period));
      });
      renderStats();
    }

    function renderStats() {
      const entries = getEntries();
      const tasks = getTasks();
      
      if (!entries.length) {
        document.getElementById('statsContent').innerHTML = `
          <div class="stats-empty">
            <p>No time entries yet.</p>
            <p style="font-size: 0.85rem; margin-top: 8px;">Start tracking to see your stats!</p>
          </div>`;
        return;
      }

      // Filter by period
      const now = new Date();
      let startDate;
      
      if (statsPeriod === 'week') {
        startDate = new Date(now);
        startDate.setDate(startDate.getDate() - 7);
      } else if (statsPeriod === 'month') {
        startDate = new Date(now);
        startDate.setDate(startDate.getDate() - 30);
      } else {
        startDate = new Date(0);
      }

      const filtered = entries.filter(e => new Date(e.startTime) >= startDate);
      
      if (!filtered.length) {
        document.getElementById('statsContent').innerHTML = `
          <div class="stats-empty">
            <p>No entries in this period.</p>
          </div>`;
        return;
      }

      // Calculate stats for filtered period
      let totalMs = 0;
      const catTotals = {};
      const descTotals = {};
      const daySet = new Set();

      filtered.forEach(e => {
        const duration = new Date(e.endTime) - new Date(e.startTime);
        totalMs += duration;
        catTotals[e.category] = (catTotals[e.category] || 0) + duration;
        descTotals[e.description] = (descTotals[e.description] || 0) + duration;
        daySet.add(getDateKey(new Date(e.startTime)));
      });

      const totalHours = totalMs / (1000 * 60 * 60);
      const avgPerDay = daySet.size > 0 ? totalHours / daySet.size : 0;

      // Tasks stats
      const filteredTasks = tasks.filter(t => {
        const taskDate = new Date(t.date);
        return taskDate >= startDate;
      });
      const completedTasks = filteredTasks.filter(t => t.done).length;

      // Sort categories by time (for period)
      const sortedCats = Object.entries(catTotals).sort((a, b) => b[1] - a[1]);
      const maxCatMs = sortedCats[0] ? sortedCats[0][1] : 1;

      // Sort descriptions by time (top 5)
      const sortedDescs = Object.entries(descTotals).sort((a, b) => b[1] - a[1]).slice(0, 5);
      const maxDescMs = sortedDescs[0] ? sortedDescs[0][1] : 1;

      // Build activity grid (last 30 days)
      const activityDays = [];
      for (let i = 29; i >= 0; i--) {
        const d = new Date(now);
        d.setDate(d.getDate() - i);
        const key = getDateKey(d);
        const dayEntries = entries.filter(e => getDateKey(new Date(e.startTime)) === key);
        let dayMs = 0;
        dayEntries.forEach(e => { dayMs += new Date(e.endTime) - new Date(e.startTime); });
        const hours = dayMs / (1000 * 60 * 60);
        let level = 0;
        if (hours > 0) level = 1;
        if (hours >= 2) level = 2;
        if (hours >= 4) level = 3;
        if (hours >= 6) level = 4;
        activityDays.push({ key, level });
      }

      document.getElementById('statsContent').innerHTML = `
        <div class="stats-grid">
          <div class="stat-card">
            <div class="stat-value">${totalHours.toFixed(1)}h</div>
            <div class="stat-label">Total Time</div>
          </div>
          <div class="stat-card">
            <div class="stat-value">${avgPerDay.toFixed(1)}h</div>
            <div class="stat-label">Avg / Day</div>
          </div>
          <div class="stat-card">
            <div class="stat-value">${completedTasks}</div>
            <div class="stat-label">Tasks Done</div>
          </div>
        </div>

        <div class="stats-section">
          <div class="stats-section-title">Time by Category</div>
          <div class="stats-bar-list">
            ${sortedCats.length ? sortedCats.map(([cat, ms]) => `
              <div class="stats-bar-item">
                <div class="stats-bar-label">${esc(cat)}</div>
                <div class="stats-bar-track">
                  <div class="stats-bar-fill" style="width: ${(ms / maxCatMs) * 100}%"></div>
                </div>
                <div class="stats-bar-value">${(ms / (1000 * 60 * 60)).toFixed(1)}h</div>
              </div>
            `).join('') : '<p style="color: var(--text-muted); font-size: 0.85rem;">No data for this period</p>'}
          </div>
        </div>

        <div class="stats-section">
          <div class="stats-section-title">Category Breakdown</div>
          <div class="stats-percentage-list">
            ${sortedCats.length ? sortedCats.map(([cat, ms]) => {
              const pct = ((ms / totalMs) * 100).toFixed(1);
              return `
              <div class="stats-percentage-item">
                <div class="stats-percentage-bar" style="width: ${pct}%"></div>
                <div class="stats-percentage-label">${esc(cat)}</div>
                <div class="stats-percentage-value">${pct}%</div>
              </div>
            `}).join('') : '<p style="color: var(--text-muted); font-size: 0.85rem;">No data for this period</p>'}
          </div>
        </div>

        <div class="stats-section">
          <div class="stats-section-title">Last 30 Days Activity</div>
          <div class="stats-activity">
            ${activityDays.map(d => `<div class="activity-day level-${d.level}" title="${d.key}"></div>`).join('')}
          </div>
        </div>
      `;
    }

    // Render content when modals open
    const origOpenModal = openModal;
    openModal = function(id) {
      if (id === 'statsModal') renderStats();
      if (id === 'categoryModal') renderCategoryList();
      if (id === 'ptoSettingsModal') loadPtoSettingsForm();
      document.getElementById(id).classList.add('active');
    };

    /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
       PTO TRACKER
       ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
    let ptoCalendarDate = new Date();
    let ptoSelectedDays = [];

    const PTO_YEAR = 2026;
    const PTO_ALLOTMENT = {
      2026: 15, 2025: 15, 2024: 18, 2023: 20, 2022: 21, 2021: 22,
      2020: 23, 2019: 24, 2018: 25, 2017: 26, 2016: 28, 2015: 28,
      2014: 28, 2013: 28, 2012: 28, 2011: 28, 2010: 30
    };

    const DEFAULT_HOLIDAYS_2026 = [
      { date: '2026-01-01', name: "New Year's Day", note: 'CLOSED' },
      { date: '2026-01-19', name: 'MLK Jr. Day', note: 'CLOSED' },
      { date: '2026-04-03', name: 'Good Friday', note: 'CLOSED' },
      { date: '2026-05-25', name: 'Memorial Day', note: 'CLOSED' },
      { date: '2026-06-19', name: 'Juneteenth', note: 'CLOSED' },
      { date: '2026-07-03', name: 'Independence Day', note: 'CLOSED' },
      { date: '2026-09-07', name: 'Labor Day', note: 'CLOSED' },
      { date: '2026-11-25', name: 'Day Before Thanksgiving', note: 'CLOSED 1PM' },
      { date: '2026-11-26', name: 'Thanksgiving', note: 'CLOSED' },
      { date: '2026-11-27', name: 'Day After Thanksgiving', note: 'CLOSED' },
      { date: '2026-12-24', name: 'Christmas Eve', note: 'CLOSED' },
      { date: '2026-12-25', name: 'Christmas Day', note: 'CLOSED' },
      { date: '2026-12-28', name: 'Extended Holiday', note: 'Volunteers' },
      { date: '2026-12-29', name: 'Extended Holiday', note: 'Volunteers' },
      { date: '2026-12-30', name: 'Extended Holiday', note: 'Volunteers' },
      { date: '2026-12-31', name: 'New Year\'s Eve', note: 'Volunteers' }
    ];

    function getPtoSettings() {
      return JSON.parse(localStorage.getItem('wb_ptoSettings')) || null;
    }

    function storePtoSettings(settings) {
      localStorage.setItem('wb_ptoSettings', JSON.stringify(settings));
    }

    function getPtoEntries() {
      return JSON.parse(localStorage.getItem('wb_ptoEntries')) || [];
    }

    function savePtoEntries(entries) {
      localStorage.setItem('wb_ptoEntries', JSON.stringify(entries));
    }

    function getPtoHolidays() {
      return JSON.parse(localStorage.getItem('wb_ptoHolidays')) || DEFAULT_HOLIDAYS_2026;
    }

    function savePtoHolidays(holidays) {
      localStorage.setItem('wb_ptoHolidays', JSON.stringify(holidays));
    }

    function getPtoDaysForYear(startYear) {
      if (startYear >= 2026) return 15;
      if (startYear <= 2010) return 30;
      return PTO_ALLOTMENT[startYear] || 15;
    }

    function initPto() {
      const settings = getPtoSettings();
      if (!settings) {
        // Show setup prompt, hide content
        document.getElementById('ptoSetupPrompt').style.display = 'block';
        document.getElementById('ptoContent').style.display = 'none';
        populateYearSelects();
      } else {
        // Hide setup prompt, show content
        document.getElementById('ptoSetupPrompt').style.display = 'none';
        document.getElementById('ptoContent').style.display = 'grid';
        renderPto();
      }
    }

    function populateYearSelects() {
      const currentYear = new Date().getFullYear();
      const years = [];
      for (let y = currentYear; y >= 2010; y--) years.push(y);
      
      const options = years.map(y => `<option value="${y}">${y}</option>`).join('');
      
      ['ptoStartYear', 'ptoSetupStartYear'].forEach(id => {
        const el = document.getElementById(id);
        if (el) el.innerHTML = options;
      });
    }

    function loadPtoSettingsForm() {
      populateYearSelects();
      const settings = getPtoSettings();
      if (settings) {
        document.getElementById('ptoStartYear').value = settings.startYear || 2025;
        document.getElementById('ptoRollover').value = settings.rolloverDays || 0;
        document.getElementById('ptoInitials').value = settings.initials || '';
        document.getElementById('ptoSupervisor').value = settings.supervisorName || '';
        document.getElementById('ptoSupervisorEmail').value = settings.supervisorEmail || '';
        document.getElementById('ptoExcludeRollover').checked = settings.excludeRollover !== false;
      }
    }

    function savePtoSettings() {
      const settings = {
        startYear: parseInt(document.getElementById('ptoStartYear').value),
        rolloverDays: parseInt(document.getElementById('ptoRollover').value) || 0,
        initials: document.getElementById('ptoInitials').value.trim(),
        supervisorName: document.getElementById('ptoSupervisor').value.trim(),
        supervisorEmail: document.getElementById('ptoSupervisorEmail').value.trim(),
        excludeRollover: document.getElementById('ptoExcludeRollover').checked
      };
      storePtoSettings(settings);
      closeModal('ptoSettingsModal');
      renderPto();
    }

    function completePtoSetup() {
      const settings = {
        startYear: parseInt(document.getElementById('ptoSetupStartYear').value),
        rolloverDays: parseInt(document.getElementById('ptoSetupRollover').value) || 0,
        initials: document.getElementById('ptoSetupInitials').value.trim(),
        supervisorName: document.getElementById('ptoSetupSupervisor').value.trim(),
        supervisorEmail: document.getElementById('ptoSetupSupervisorEmail').value.trim(),
        excludeRollover: true
      };
      
      if (!settings.initials || !settings.supervisorName) {
        alert('Please fill in your initials and supervisor name.');
        return;
      }
      
      storePtoSettings(settings);
      savePtoHolidays(DEFAULT_HOLIDAYS_2026);
      closeModal('ptoSetupModal');
      
      // Show content, hide prompt
      document.getElementById('ptoSetupPrompt').style.display = 'none';
      document.getElementById('ptoContent').style.display = 'grid';
      renderPto();
    }

    function renderPto() {
      const settings = getPtoSettings();
      if (!settings) {
        initPto();
        return;
      }

      // Ensure content is visible
      document.getElementById('ptoSetupPrompt').style.display = 'none';
      document.getElementById('ptoContent').style.display = 'grid';

      const entries = getPtoEntries();
      const holidays = getPtoHolidays();
      const baseDays = getPtoDaysForYear(settings.startYear);
      const totalDays = baseDays + (settings.rolloverDays || 0);
      const usedDays = entries.length;
      const remainingDays = totalDays - usedDays;
      
      // Calculate percentage (optionally excluding rollover)
      const percentBase = settings.excludeRollover ? baseDays : totalDays;
      const percentUsed = percentBase > 0 ? ((usedDays / percentBase) * 100).toFixed(1) : 0;

      // Check if using rollover days
      const usingRollover = usedDays > baseDays;
      const rolloverUsed = usingRollover ? usedDays - baseDays : 0;
      const rolloverRemaining = (settings.rolloverDays || 0) - rolloverUsed;

      // Days since last PTO
      let daysSinceLastPto = null;
      if (entries.length > 0) {
        const sortedEntries = [...entries].sort((a, b) => new Date(b.date) - new Date(a.date));
        const lastPto = new Date(sortedEntries[0].date);
        const today = new Date();
        daysSinceLastPto = Math.floor((today - lastPto) / (1000 * 60 * 60 * 24));
      }

      // Render stats
      document.getElementById('ptoStats').innerHTML = `
        <div class="pto-stat-card">
          <div class="pto-stat-value">${usedDays}</div>
          <div class="pto-stat-label">Days Used</div>
        </div>
        <div class="pto-stat-card ${remainingDays <= 3 ? 'warning' : ''}">
          <div class="pto-stat-value">${remainingDays}</div>
          <div class="pto-stat-label">Days Left</div>
        </div>
        <div class="pto-stat-card">
          <div class="pto-stat-value">${percentUsed}%</div>
          <div class="pto-stat-label">Used${settings.excludeRollover ? ' (excl. rollover)' : ''}</div>
        </div>
        <div class="pto-stat-card ${usingRollover ? 'warning' : ''}">
          <div class="pto-stat-value">${rolloverRemaining}</div>
          <div class="pto-stat-label">Rollover Left</div>
        </div>
      `;

      // Holiday alert
      const today = new Date();
      const todayStr = getDateKey(today);
      const upcomingHolidays = holidays.filter(h => h.date >= todayStr).sort((a, b) => a.date.localeCompare(b.date));
      const nextHoliday = upcomingHolidays[0];
      
      if (nextHoliday) {
        const holidayDate = new Date(nextHoliday.date + 'T00:00:00');
        const daysUntil = Math.ceil((holidayDate - today) / (1000 * 60 * 60 * 24));
        
        document.getElementById('ptoHolidayAlert').innerHTML = `
          <div class="pto-holiday-alert-icon">üéâ</div>
          <div class="pto-holiday-alert-content">
            <div class="pto-holiday-alert-title">${daysUntil === 0 ? 'Today is' : daysUntil === 1 ? 'Tomorrow is' : `${daysUntil} days until`} ${nextHoliday.name}!</div>
            <div class="pto-holiday-alert-subtitle">${formatPtoDate(nextHoliday.date)} ${nextHoliday.note ? '¬∑ ' + nextHoliday.note : ''}</div>
          </div>
        `;
      } else {
        document.getElementById('ptoHolidayAlert').innerHTML = '';
      }

      // Render calendar
      renderPtoCalendar();

      // Render selected days
      renderPtoSelectedDays();

      // Render history
      renderPtoHistory();

      // Render holidays sidebar
      document.getElementById('ptoHolidays').innerHTML = holidays.map(h => {
        const isPast = h.date < todayStr;
        const isNext = nextHoliday && h.date === nextHoliday.date;
        return `
          <div class="pto-holiday-item ${isPast ? 'past' : ''} ${isNext ? 'next' : ''}">
            <div class="pto-holiday-date">${formatPtoDateShort(h.date)}</div>
            <div class="pto-holiday-name">${h.name}</div>
            ${h.note ? `<div class="pto-holiday-note">${h.note}</div>` : ''}
          </div>
        `;
      }).join('');

      // Add nudge if it's been a while
      if (daysSinceLastPto !== null && daysSinceLastPto > 60) {
        document.getElementById('ptoHolidays').innerHTML += `
          <div class="pto-nudge">
            ‚è∞ It's been ${daysSinceLastPto} days since your last PTO. Maybe time for a break?
          </div>
        `;
      }
    }

    function renderPtoCalendar() {
      const settings = getPtoSettings();
      const entries = getPtoEntries();
      const holidays = getPtoHolidays();
      const usedDates = new Set(entries.map(e => e.date));
      const holidayDates = new Set(holidays.map(h => h.date));

      const year = ptoCalendarDate.getFullYear();
      const month = ptoCalendarDate.getMonth();
      
      document.getElementById('ptoCalendarMonth').textContent = 
        ptoCalendarDate.toLocaleDateString('en-US', { month: 'long', year: 'numeric' });

      const firstDay = new Date(year, month, 1);
      const lastDay = new Date(year, month + 1, 0);
      const startPadding = firstDay.getDay();
      const today = getDateKey(new Date());

      let html = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat']
        .map(d => `<div class="pto-calendar-day-header">${d}</div>`).join('');

      // Previous month padding
      const prevMonth = new Date(year, month, 0);
      for (let i = startPadding - 1; i >= 0; i--) {
        const day = prevMonth.getDate() - i;
        html += `<div class="pto-calendar-day other-month">${day}</div>`;
      }

      // Current month
      for (let day = 1; day <= lastDay.getDate(); day++) {
        const date = `${year}-${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
        const dayOfWeek = new Date(year, month, day).getDay();
        const isWeekend = dayOfWeek === 0 || dayOfWeek === 6;
        const isToday = date === today;
        const isSelected = ptoSelectedDays.includes(date);
        const isHoliday = holidayDates.has(date);
        const isUsed = usedDates.has(date);

        let classes = ['pto-calendar-day'];
        if (isWeekend) classes.push('weekend');
        if (isToday) classes.push('today');
        if (isSelected) classes.push('selected');
        if (isHoliday) classes.push('holiday');
        if (isUsed) classes.push('used');

        const clickable = !isWeekend && !isHoliday && !isUsed && year === PTO_YEAR;
        html += `<div class="${classes.join(' ')}" ${clickable ? `onclick="togglePtoDay('${date}')"` : ''}>${day}</div>`;
      }

      // Next month padding
      const remaining = 42 - (startPadding + lastDay.getDate());
      for (let i = 1; i <= remaining; i++) {
        html += `<div class="pto-calendar-day other-month">${i}</div>`;
      }

      document.getElementById('ptoCalendar').innerHTML = html;
    }

    function changePtoMonth(delta) {
      ptoCalendarDate.setMonth(ptoCalendarDate.getMonth() + delta);
      renderPtoCalendar();
    }

    function togglePtoDay(date) {
      const idx = ptoSelectedDays.indexOf(date);
      if (idx >= 0) {
        ptoSelectedDays.splice(idx, 1);
      } else {
        ptoSelectedDays.push(date);
      }
      ptoSelectedDays.sort();
      renderPtoCalendar();
      renderPtoSelectedDays();
    }

    function renderPtoSelectedDays() {
      const container = document.getElementById('ptoSelected');
      const emailSection = document.getElementById('ptoEmailSection');

      if (ptoSelectedDays.length === 0) {
        container.innerHTML = '<p style="color: var(--text-muted); font-size: 0.9rem;">Click on calendar days to select time off</p>';
        emailSection.style.display = 'none';
        return;
      }

      container.innerHTML = `
        <div class="pto-selected-days">
          ${ptoSelectedDays.map(d => `
            <div class="pto-selected-day">
              ${formatPtoDate(d)}
              <button onclick="togglePtoDay('${d}')">&times;</button>
            </div>
          `).join('')}
        </div>
      `;

      emailSection.style.display = 'block';
      generatePtoEmail();
    }

    function generatePtoEmail() {
      const settings = getPtoSettings();
      if (!settings || ptoSelectedDays.length === 0) return;

      const daysText = ptoSelectedDays.map(d => formatPtoDateLong(d)).join('\n');
      const monthNames = [...new Set(ptoSelectedDays.map(d => {
        const date = new Date(d + 'T00:00:00');
        return date.toLocaleDateString('en-US', { month: 'long' });
      }))];

      const monthText = monthNames.length === 1 ? monthNames[0] : 'the following dates';
      
      const email = `Hi ${settings.supervisorName}, I would like to take the following day${ptoSelectedDays.length > 1 ? 's' : ''} off in ${monthText}:\n\n${daysText}`;

      document.getElementById('ptoEmailPreview').value = email;
    }

    function copyPtoEmail() {
      const text = document.getElementById('ptoEmailPreview').value;
      navigator.clipboard.writeText(text).then(() => {
        alert('Email copied to clipboard!');
      });
    }

    function openPtoEmailClient() {
      const settings = getPtoSettings();
      const subject = encodeURIComponent(`PTO - ${settings.initials}`);
      const body = encodeURIComponent(document.getElementById('ptoEmailPreview').value);
      const email = settings.supervisorEmail || '';
      window.open(`mailto:${email}?subject=${subject}&body=${body}`);
    }

    function confirmPtoRequest() {
      if (!confirm(`Confirm that you have sent the PTO request and received approval?\n\nThis will log ${ptoSelectedDays.length} day(s) to your PTO history.`)) {
        return;
      }

      const entries = getPtoEntries();
      ptoSelectedDays.forEach(date => {
        if (!entries.find(e => e.date === date)) {
          entries.push({
            id: Date.now().toString() + Math.random().toString(36).substr(2, 9),
            date,
            type: 'vacation',
            confirmedAt: new Date().toISOString()
          });
        }
      });

      savePtoEntries(entries);
      ptoSelectedDays = [];
      renderPto();
    }

    function renderPtoHistory() {
      const entries = getPtoEntries().sort((a, b) => b.date.localeCompare(a.date));
      const container = document.getElementById('ptoHistory');

      if (entries.length === 0) {
        container.innerHTML = `
          <div class="pto-empty-state">
            <div class="pto-empty-state-icon">üèñÔ∏è</div>
            <div class="pto-empty-state-title">No PTO taken yet</div>
            <div class="pto-empty-state-text">Select days on the calendar above to request time off, or add past entries manually.</div>
          </div>
        `;
        return;
      }

      container.innerHTML = entries.map(e => `
        <div class="pto-history-item">
          <div class="pto-history-date">${formatPtoDate(e.date)}</div>
          <span class="pto-history-type">${e.type || 'vacation'}</span>
          <div class="pto-history-actions">
            <button class="btn-icon danger" onclick="deletePtoEntry('${e.id}')" title="Delete">
              <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>
              </svg>
            </button>
          </div>
        </div>
      `).join('');
    }

    function deletePtoEntry(id) {
      if (!confirm('Delete this PTO entry?')) return;
      savePtoEntries(getPtoEntries().filter(e => e.id !== id));
      renderPto();
    }

    function addManualPtoEntry() {
      const date = document.getElementById('ptoManualDate').value;
      const type = document.getElementById('ptoManualType').value;
      const notes = document.getElementById('ptoManualNotes').value.trim();

      if (!date) {
        alert('Please select a date');
        return;
      }

      const entries = getPtoEntries();
      if (entries.find(e => e.date === date)) {
        alert('This date is already logged');
        return;
      }

      entries.push({
        id: Date.now().toString(),
        date,
        type,
        notes,
        confirmedAt: new Date().toISOString(),
        manual: true
      });

      savePtoEntries(entries);
      closeModal('ptoManualEntryModal');
      document.getElementById('ptoManualDate').value = '';
      document.getElementById('ptoManualNotes').value = '';
      renderPto();
    }

    function exportPtoData() {
      const data = {
        settings: getPtoSettings(),
        entries: getPtoEntries(),
        holidays: getPtoHolidays(),
        exportedAt: new Date().toISOString()
      };
      const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `pto-export-${getDateKey(new Date())}.json`;
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
    }

    function importPtoData(event) {
      const file = event.target.files[0];
      if (!file) return;
      const reader = new FileReader();
      reader.onload = function(e) {
        try {
          const data = JSON.parse(e.target.result);
          
          if (data.settings) storePtoSettings(data.settings);
          if (data.entries) savePtoEntries(data.entries);
          if (data.holidays) savePtoHolidays(data.holidays);
          
          closeModal('ptoSettingsModal');
          renderPto();
          alert('PTO data imported successfully!');
        } catch (err) {
          alert('Error importing: ' + err.message);
        }
      };
      reader.readAsText(file);
      event.target.value = '';
    }

    function formatPtoDate(dateStr) {
      const date = new Date(dateStr + 'T00:00:00');
      return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric', weekday: 'short' });
    }

    function formatPtoDateLong(dateStr) {
      const date = new Date(dateStr + 'T00:00:00');
      return date.toLocaleDateString('en-US', { month: 'long', day: 'numeric', weekday: 'long' });
    }

    function formatPtoDateShort(dateStr) {
      const date = new Date(dateStr + 'T00:00:00');
      return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
    }

    /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
       EXPORT / IMPORT
       ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
    function exportData() {
      const data = { 
        version: 4, 
        categories: getCategories(), 
        entries: getEntries(), 
        tasks: getTasks(), 
        notes: getNotes(),
        pto: {
          settings: getPtoSettings(),
          entries: getPtoEntries(),
          holidays: getPtoHolidays()
        },
        exportedAt: new Date().toISOString() 
      };
      const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a'); a.href = url; a.download = `workbench-export-${getDateKey(new Date())}.json`;
      document.body.appendChild(a); a.click(); document.body.removeChild(a);
      URL.revokeObjectURL(url);
    }

    function importData(event) {
      const file = event.target.files[0];
      if (!file) return;
      const reader = new FileReader();
      reader.onload = function(e) {
        try {
          const data = JSON.parse(e.target.result);
          const hasEntries = data.entries && Array.isArray(data.entries);
          const hasTasks = data.tasks && Array.isArray(data.tasks);
          const hasNotes = data.notes && typeof data.notes === 'object';
          const hasPto = data.pto && typeof data.pto === 'object';
          if (!hasEntries && !hasTasks && !hasNotes && !hasPto) { alert('Invalid file: no data found'); return; }

          const notesCount = hasNotes ? Object.keys(data.notes).length : 0;
          const ptoCount = hasPto && data.pto.entries ? data.pto.entries.length : 0;
          const merge = confirm(`Import options:\n\nOK = Merge with existing data\nCancel = Replace all existing data\n\nFound: ${hasEntries ? data.entries.length : 0} time entries, ${hasTasks ? data.tasks.length : 0} tasks, ${notesCount} notes, ${ptoCount} PTO entries`);

          if (merge) {
            if (hasEntries) { const ex = getEntries(); const ids = new Set(ex.map(e=>e.id)); localStorage.setItem('wb_timeEntries', JSON.stringify([...ex, ...data.entries.filter(e=>!ids.has(e.id))])); }
            if (hasTasks) { const ex = getTasks(); const ids = new Set(ex.map(t=>t.id)); localStorage.setItem('wb_tasks', JSON.stringify([...ex, ...data.tasks.filter(t=>!ids.has(t.id))])); }
            if (data.categories) localStorage.setItem('wb_categories', JSON.stringify([...new Set([...getCategories(), ...data.categories])]));
            if (hasNotes) {
              const existing = getNotes();
              Object.entries(data.notes).forEach(([date, content]) => {
                if (!existing[date]) existing[date] = content;
              });
              saveNotes(existing);
            }
            if (hasPto) {
              if (data.pto.entries) {
                const ex = getPtoEntries();
                const ids = new Set(ex.map(e => e.id));
                savePtoEntries([...ex, ...data.pto.entries.filter(e => !ids.has(e.id))]);
              }
              // For settings and holidays, only import if none exist
              if (data.pto.settings && !getPtoSettings()) storePtoSettings(data.pto.settings);
              if (data.pto.holidays && getPtoHolidays().length === 0) savePtoHolidays(data.pto.holidays);
            }
          } else {
            if (hasEntries) localStorage.setItem('wb_timeEntries', JSON.stringify(data.entries));
            if (hasTasks) localStorage.setItem('wb_tasks', JSON.stringify(data.tasks));
            if (data.categories) localStorage.setItem('wb_categories', JSON.stringify(data.categories));
            if (hasNotes) saveNotes(data.notes);
            if (hasPto) {
              if (data.pto.settings) storePtoSettings(data.pto.settings);
              if (data.pto.entries) savePtoEntries(data.pto.entries);
              if (data.pto.holidays) savePtoHolidays(data.pto.holidays);
            }
          }

          updateCategorySelect(); renderTimeEntries(); renderTasks(); renderNotes();
          alert('Import complete');
        } catch (err) { alert('Error: ' + err.message); }
      };
      reader.readAsText(file);
      event.target.value = '';
    }

    /* ‚îÄ‚îÄ Migrate old keys ‚îÄ‚îÄ */
    function migrateOldData() {
      if (localStorage.getItem('timeEntries') && !localStorage.getItem('wb_timeEntries'))
        localStorage.setItem('wb_timeEntries', localStorage.getItem('timeEntries'));
      if (localStorage.getItem('categories') && !localStorage.getItem('wb_categories'))
        localStorage.setItem('wb_categories', localStorage.getItem('categories'));
      if (localStorage.getItem('runningTimer') && !localStorage.getItem('wb_runningTimer'))
        localStorage.setItem('wb_runningTimer', localStorage.getItem('runningTimer'));
    }

    /* ‚îÄ‚îÄ Init ‚îÄ‚îÄ */
    function init() {
      migrateOldData();
      if (!localStorage.getItem('wb_categories')) localStorage.setItem('wb_categories', JSON.stringify(defaultCategories));
      const running = localStorage.getItem('wb_runningTimer');
      if (running) {
        const t = JSON.parse(running);
        startTime = new Date(t.startTime);
        document.getElementById('description').value = t.description;
        resumeTimer();
      }
      updateCategorySelect();
      renderTimeEntries();
      renderTasks();
      renderNotes();
      
      // Notes editor input listener
      document.getElementById('notesEditor').addEventListener('input', onNotesInput);
    }

    document.querySelectorAll('.modal-overlay').forEach(o => { o.addEventListener('click', e => { if (e.target === o) o.classList.remove('active'); }); });
    document.addEventListener('keydown', e => {
      if (e.key === 'Escape') document.querySelectorAll('.modal-overlay').forEach(m => m.classList.remove('active'));
      if (e.key === 'Enter' && document.activeElement.id === 'newCategory') addCategory();
      if (e.key === 'Enter' && document.activeElement.id === 'taskTitle') addTask();
    });

    init();
  </script>
</body>
</html>